<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Data Modeling | Intermediate R</title>
  <meta name="description" content="4 Data Modeling | Intermediate R" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Data Modeling | Intermediate R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Data Modeling | Intermediate R" />
  
  
  

<meta name="author" content="MAJ Dusty Turner" />


<meta name="date" content="2020-06-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="3-data-visualization.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href = "/">Tutorial Home</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Class Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#expectations"><i class="fa fa-check"></i><b>1.1</b> Expectations</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#class-introductions"><i class="fa fa-check"></i><b>1.2</b> Class Introductions</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#instructor-introduction"><i class="fa fa-check"></i><b>1.3</b> Instructor Introduction</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#course-intent"><i class="fa fa-check"></i><b>1.4</b> Course Intent</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#get-course-documents"><i class="fa fa-check"></i><b>1.5</b> Get Course Documents</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html"><i class="fa fa-check"></i><b>2</b> Data Manipulation</a><ul>
<li class="chapter" data-level="2.1" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#read-in-data"><i class="fa fa-check"></i><b>2.1</b> Read in Data</a></li>
<li class="chapter" data-level="2.2" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#analysis-with-dplyr"><i class="fa fa-check"></i><b>2.2</b> Analysis with <code>dplyr</code></a></li>
<li class="chapter" data-level="2.3" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#joins"><i class="fa fa-check"></i><b>2.3</b> Joins</a></li>
<li class="chapter" data-level="2.4" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#other-dplyr-tricks"><i class="fa fa-check"></i><b>2.4</b> Other dplyr Tricks</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-data-visualization.html"><a href="3-data-visualization.html"><i class="fa fa-check"></i><b>3</b> Data Visualization</a><ul>
<li class="chapter" data-level="3.1" data-path="3-data-visualization.html"><a href="3-data-visualization.html#bar-chart"><i class="fa fa-check"></i><b>3.1</b> Bar Chart</a></li>
<li class="chapter" data-level="" data-path="3-data-visualization.html"><a href="3-data-visualization.html#scatter-plot"><i class="fa fa-check"></i>Scatter Plot</a></li>
<li class="chapter" data-level="3.2" data-path="3-data-visualization.html"><a href="3-data-visualization.html#animation"><i class="fa fa-check"></i><b>3.2</b> Animation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-data-modeling.html"><a href="4-data-modeling.html"><i class="fa fa-check"></i><b>4</b> Data Modeling</a><ul>
<li class="chapter" data-level="4.1" data-path="4-data-modeling.html"><a href="4-data-modeling.html#load-packages"><i class="fa fa-check"></i><b>4.1</b> Load Packages</a></li>
<li class="chapter" data-level="4.2" data-path="4-data-modeling.html"><a href="4-data-modeling.html#read-data"><i class="fa fa-check"></i><b>4.2</b> Read Data</a></li>
<li class="chapter" data-level="4.3" data-path="4-data-modeling.html"><a href="4-data-modeling.html#data-exploration"><i class="fa fa-check"></i><b>4.3</b> Data Exploration</a></li>
<li class="chapter" data-level="4.4" data-path="4-data-modeling.html"><a href="4-data-modeling.html#split-data-testtrain"><i class="fa fa-check"></i><b>4.4</b> Split Data test/train</a></li>
<li class="chapter" data-level="4.5" data-path="4-data-modeling.html"><a href="4-data-modeling.html#preprocess-data"><i class="fa fa-check"></i><b>4.5</b> Preprocess Data</a></li>
<li class="chapter" data-level="4.6" data-path="4-data-modeling.html"><a href="4-data-modeling.html#apply-preprocessing"><i class="fa fa-check"></i><b>4.6</b> Apply Preprocessing</a></li>
<li class="chapter" data-level="4.7" data-path="4-data-modeling.html"><a href="4-data-modeling.html#prepare-cross-validation"><i class="fa fa-check"></i><b>4.7</b> Prepare Cross Validation</a></li>
<li class="chapter" data-level="4.8" data-path="4-data-modeling.html"><a href="4-data-modeling.html#specify-models"><i class="fa fa-check"></i><b>4.8</b> Specify Models</a></li>
<li class="chapter" data-level="4.9" data-path="4-data-modeling.html"><a href="4-data-modeling.html#create-grid-of-parameters-to-validate-over"><i class="fa fa-check"></i><b>4.9</b> Create Grid of Parameters to Validate Over</a></li>
<li class="chapter" data-level="4.10" data-path="4-data-modeling.html"><a href="4-data-modeling.html#execute-cross-validation"><i class="fa fa-check"></i><b>4.10</b> Execute Cross Validation</a></li>
<li class="chapter" data-level="4.11" data-path="4-data-modeling.html"><a href="4-data-modeling.html#select-best-parameters"><i class="fa fa-check"></i><b>4.11</b> Select Best Parameters</a></li>
<li class="chapter" data-level="4.12" data-path="4-data-modeling.html"><a href="4-data-modeling.html#save-best-paramenters"><i class="fa fa-check"></i><b>4.12</b> Save Best Paramenters</a></li>
<li class="chapter" data-level="4.13" data-path="4-data-modeling.html"><a href="4-data-modeling.html#compare-models"><i class="fa fa-check"></i><b>4.13</b> Compare Models</a></li>
<li class="chapter" data-level="4.14" data-path="4-data-modeling.html"><a href="4-data-modeling.html#run-best-model-on-all-data"><i class="fa fa-check"></i><b>4.14</b> Run Best Model on All Data</a></li>
<li class="chapter" data-level="4.15" data-path="4-data-modeling.html"><a href="4-data-modeling.html#run-model-on-new-data"><i class="fa fa-check"></i><b>4.15</b> Run Model on New Data</a></li>
<li class="chapter" data-level="4.16" data-path="4-data-modeling.html"><a href="4-data-modeling.html#variable-importance"><i class="fa fa-check"></i><b>4.16</b> Variable Importance</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intermediate R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-modeling" class="section level1">
<h1><span class="header-section-number">4</span> Data Modeling</h1>
<div id="load-packages" class="section level2">
<h2><span class="header-section-number">4.1</span> Load Packages</h2>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="4-data-modeling.html#cb77-1"></a><span class="kw">library</span>(tidymodels)</span>
<span id="cb77-2"><a href="4-data-modeling.html#cb77-2"></a><span class="kw">library</span>(tune)</span>
<span id="cb77-3"><a href="4-data-modeling.html#cb77-3"></a><span class="kw">library</span>(dials)</span>
<span id="cb77-4"><a href="4-data-modeling.html#cb77-4"></a><span class="kw">library</span>(parsnip)</span>
<span id="cb77-5"><a href="4-data-modeling.html#cb77-5"></a><span class="kw">library</span>(rsample)</span>
<span id="cb77-6"><a href="4-data-modeling.html#cb77-6"></a><span class="kw">library</span>(recipes)</span>
<span id="cb77-7"><a href="4-data-modeling.html#cb77-7"></a><span class="kw">library</span>(textrecipes)</span>
<span id="cb77-8"><a href="4-data-modeling.html#cb77-8"></a><span class="kw">library</span>(yardstick)</span>
<span id="cb77-9"><a href="4-data-modeling.html#cb77-9"></a><span class="kw">library</span>(vip)</span>
<span id="cb77-10"><a href="4-data-modeling.html#cb77-10"></a><span class="kw">library</span>(gghighlight)</span>
<span id="cb77-11"><a href="4-data-modeling.html#cb77-11"></a><span class="kw">library</span>(patchwork)</span>
<span id="cb77-12"><a href="4-data-modeling.html#cb77-12"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb77-13"><a href="4-data-modeling.html#cb77-13"></a><span class="kw">library</span>(tidyquant)</span>
<span id="cb77-14"><a href="4-data-modeling.html#cb77-14"></a><span class="kw">library</span>(knitr)</span>
<span id="cb77-15"><a href="4-data-modeling.html#cb77-15"></a><span class="kw">library</span>(janitor)</span></code></pre></div>
</div>
<div id="read-data" class="section level2">
<h2><span class="header-section-number">4.2</span> Read Data</h2>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="4-data-modeling.html#cb78-1"></a>data =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;Batting.csv&quot;</span>, <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">SF =</span> <span class="kw">col_double</span>(), <span class="dt">GIDP =</span> <span class="kw">col_double</span>())) <span class="op">%&gt;%</span></span>
<span id="cb78-2"><a href="4-data-modeling.html#cb78-2"></a><span class="st">  </span><span class="kw">clean_names</span>()</span>
<span id="cb78-3"><a href="4-data-modeling.html#cb78-3"></a></span>
<span id="cb78-4"><a href="4-data-modeling.html#cb78-4"></a>hofdata =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;HallOfFame.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-5"><a href="4-data-modeling.html#cb78-5"></a><span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-6"><a href="4-data-modeling.html#cb78-6"></a><span class="st">  </span><span class="kw">select</span>(player_id, inducted) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-7"><a href="4-data-modeling.html#cb78-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hof =</span> <span class="kw">ifelse</span>(inducted<span class="op">==</span><span class="st">&quot;Y&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb78-8"><a href="4-data-modeling.html#cb78-8"></a><span class="st">  </span><span class="kw">filter</span>(hof<span class="op">==</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   playerID = col_character(),
##   yearid = col_double(),
##   votedBy = col_character(),
##   ballots = col_double(),
##   needed = col_double(),
##   votes = col_double(),
##   inducted = col_character(),
##   category = col_character(),
##   needed_note = col_character()
## )</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="4-data-modeling.html#cb80-1"></a>hofdata <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">count</span>(inducted)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   inducted     n
##   &lt;chr&gt;    &lt;int&gt;
## 1 Y          317</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="4-data-modeling.html#cb82-1"></a>retiredyear =<span class="st"> </span></span>
<span id="cb82-2"><a href="4-data-modeling.html#cb82-2"></a>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-3"><a href="4-data-modeling.html#cb82-3"></a><span class="st">  </span><span class="kw">group_by</span>(player_id) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-4"><a href="4-data-modeling.html#cb82-4"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">lastyear =</span> <span class="kw">max</span>(year_id))</span>
<span id="cb82-5"><a href="4-data-modeling.html#cb82-5"></a></span>
<span id="cb82-6"><a href="4-data-modeling.html#cb82-6"></a>hof =</span>
<span id="cb82-7"><a href="4-data-modeling.html#cb82-7"></a>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-8"><a href="4-data-modeling.html#cb82-8"></a><span class="st">  </span><span class="kw">group_by</span>(player_id) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-9"><a href="4-data-modeling.html#cb82-9"></a><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(g<span class="op">:</span>gidp), <span class="kw">list</span>(<span class="op">~</span><span class="kw">sum</span>(.,<span class="dt">na.rm =</span> <span class="ot">TRUE</span>))) <span class="op">%&gt;%</span></span>
<span id="cb82-10"><a href="4-data-modeling.html#cb82-10"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb82-11"><a href="4-data-modeling.html#cb82-11"></a><span class="st">  </span><span class="kw">left_join</span>(retiredyear) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-12"><a href="4-data-modeling.html#cb82-12"></a><span class="st">  </span><span class="kw">left_join</span>(hofdata) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-13"><a href="4-data-modeling.html#cb82-13"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">inducted =</span> <span class="kw">if_else</span>(inducted<span class="op">==</span><span class="st">&quot;Y&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-14"><a href="4-data-modeling.html#cb82-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">inducted =</span> <span class="kw">replace_na</span>(inducted, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-15"><a href="4-data-modeling.html#cb82-15"></a><span class="st">  </span><span class="kw">filter</span>(g<span class="op">&gt;=</span><span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-16"><a href="4-data-modeling.html#cb82-16"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">inducted =</span> <span class="kw">as.factor</span>(inducted)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb82-17"><a href="4-data-modeling.html#cb82-17"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>hof)</span></code></pre></div>
<pre><code>## Joining, by = &quot;player_id&quot;</code></pre>
<pre><code>## Joining, by = &quot;player_id&quot;</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="4-data-modeling.html#cb85-1"></a>hof</span></code></pre></div>
<pre><code>## # A tibble: 1,565 x 20
##    player_id     g    ab     r     h   x2b   x3b    hr   rbi    sb    cs    bb    so
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 aaronha01  3298 12364  2174  3771   624    98   755  2297   240    73  1402  1383
##  2 abreubo01  2425  8480  1453  2470   574    59   288  1363   400   128  1476  1840
##  3 adairje01  1165  4019   378  1022   163    19    57   366    29    29   208   499
##  4 adamsbo03  1281  4019   591  1082   188    49    37   303    67    30   414   447
##  5 adamssp01  1424  5557   844  1588   249    48     9   394   154    50   453   223
##  6 adcocjo01  1959  6606   823  1832   295    35   336  1122    20    25   594  1059
##  7 ageeto01   1129  3912   558   999   170    27   130   433   167    81   342   918
##  8 ainsmed01  1078  3048   299   707   108    54    22   317    86    16   263   315
##  9 alfoned01  1506  5385   777  1532   282    18   146   744    53    17   596   617
## 10 alicelu01  1341  3971   551  1031   189    53    47   422    81    50   500   624
## # ... with 1,555 more rows, and 7 more variables: ibb &lt;dbl&gt;, hbp &lt;dbl&gt;, sh &lt;dbl&gt;,
## #   sf &lt;dbl&gt;, gidp &lt;dbl&gt;, lastyear &lt;dbl&gt;, inducted &lt;fct&gt;</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="4-data-modeling.html#cb87-1"></a>hof <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb87-2"><a href="4-data-modeling.html#cb87-2"></a><span class="st">  </span><span class="kw">filter</span>(lastyear <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2012</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb87-3"><a href="4-data-modeling.html#cb87-3"></a><span class="st">  </span><span class="kw">count</span>(inducted) </span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   inducted     n
##   &lt;fct&gt;    &lt;int&gt;
## 1 0         1229
## 2 1          168</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="4-data-modeling.html#cb89-1"></a>hofmod =</span>
<span id="cb89-2"><a href="4-data-modeling.html#cb89-2"></a>hof <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb89-3"><a href="4-data-modeling.html#cb89-3"></a><span class="st">  </span><span class="kw">filter</span>(lastyear <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2012</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb89-4"><a href="4-data-modeling.html#cb89-4"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>lastyear)</span>
<span id="cb89-5"><a href="4-data-modeling.html#cb89-5"></a>hofmod</span></code></pre></div>
<pre><code>## # A tibble: 1,397 x 19
##    player_id     g    ab     r     h   x2b   x3b    hr   rbi    sb    cs    bb    so
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 aaronha01  3298 12364  2174  3771   624    98   755  2297   240    73  1402  1383
##  2 adairje01  1165  4019   378  1022   163    19    57   366    29    29   208   499
##  3 adamsbo03  1281  4019   591  1082   188    49    37   303    67    30   414   447
##  4 adamssp01  1424  5557   844  1588   249    48     9   394   154    50   453   223
##  5 adcocjo01  1959  6606   823  1832   295    35   336  1122    20    25   594  1059
##  6 ageeto01   1129  3912   558   999   170    27   130   433   167    81   342   918
##  7 ainsmed01  1078  3048   299   707   108    54    22   317    86    16   263   315
##  8 alfoned01  1506  5385   777  1532   282    18   146   744    53    17   596   617
##  9 alicelu01  1341  3971   551  1031   189    53    47   422    81    50   500   624
## 10 allenbe01  1139  3404   357   815   140    21    73   351    13    16   370   424
## # ... with 1,387 more rows, and 6 more variables: ibb &lt;dbl&gt;, hbp &lt;dbl&gt;, sh &lt;dbl&gt;,
## #   sf &lt;dbl&gt;, gidp &lt;dbl&gt;, inducted &lt;fct&gt;</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="4-data-modeling.html#cb91-1"></a>hoftest =<span class="st"> </span></span>
<span id="cb91-2"><a href="4-data-modeling.html#cb91-2"></a>hof <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb91-3"><a href="4-data-modeling.html#cb91-3"></a><span class="st">  </span><span class="kw">filter</span>(lastyear <span class="op">&gt;</span><span class="st"> </span><span class="dv">2012</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb91-4"><a href="4-data-modeling.html#cb91-4"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>lastyear,<span class="op">-</span>inducted)</span>
<span id="cb91-5"><a href="4-data-modeling.html#cb91-5"></a>hoftest</span></code></pre></div>
<pre><code>## # A tibble: 168 x 18
##    player_id     g    ab     r     h   x2b   x3b    hr   rbi    sb    cs    bb    so
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 abreubo01  2425  8480  1453  2470   574    59   288  1363   400   128  1476  1840
##  2 andruel01  1221  4625   648  1266   207    37    35   436   241    83   408   684
##  3 aybarer01  1346  4842   606  1324   241    45    51   451   144    58   257   613
##  4 barmecl01  1186  3805   434   932   208    17    89   415    43    30   216   734
##  5 bautijo02  1519  5139   878  1311   267    17   308   862    60    26   881  1113
##  6 bayja01    1278  4505   737  1200   240    30   222   754    95    17   636  1216
##  7 beltrad01  2720 10295  1428  2942   591    36   445  1571   119    42   775  1584
##  8 beltrca01  2457  9301  1522  2617   536    78   421  1536   312    49  1051  1693
##  9 berkmla01  1879  6491  1146  1905   422    30   366  1234    86    48  1201  1300
## 10 betanyu01  1156  4052   437  1057   218    29    80   457    30    30   143   435
## # ... with 158 more rows, and 5 more variables: ibb &lt;dbl&gt;, hbp &lt;dbl&gt;, sh &lt;dbl&gt;,
## #   sf &lt;dbl&gt;, gidp &lt;dbl&gt;</code></pre>
</div>
<div id="data-exploration" class="section level2">
<h2><span class="header-section-number">4.3</span> Data Exploration</h2>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="4-data-modeling.html#cb93-1"></a>hofmod <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-2"><a href="4-data-modeling.html#cb93-2"></a><span class="st">  </span><span class="kw">select</span>(g<span class="op">:</span>inducted) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb93-3"><a href="4-data-modeling.html#cb93-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> g<span class="op">:</span>gidp) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb93-4"><a href="4-data-modeling.html#cb93-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>value,<span class="dt">y=</span><span class="kw">as.factor</span>(inducted),<span class="dt">color =</span> name)) <span class="op">+</span></span>
<span id="cb93-5"><a href="4-data-modeling.html#cb93-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb93-6"><a href="4-data-modeling.html#cb93-6"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></span>
<span id="cb93-7"><a href="4-data-modeling.html#cb93-7"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="Intermediate_R_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
</div>
<div id="split-data-testtrain" class="section level2">
<h2><span class="header-section-number">4.4</span> Split Data test/train</h2>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="4-data-modeling.html#cb94-1"></a><span class="kw">set.seed</span>(<span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(<span class="st">&quot;beatnavy&quot;</span>)))</span>
<span id="cb94-2"><a href="4-data-modeling.html#cb94-2"></a>hof_initial_split &lt;-<span class="st"> </span><span class="kw">initial_split</span>(hofmod, <span class="dt">prop =</span> <span class="fl">0.80</span>)</span>
<span id="cb94-3"><a href="4-data-modeling.html#cb94-3"></a>hof_initial_split</span></code></pre></div>
<pre><code>## &lt;1118/279/1397&gt;</code></pre>
</div>
<div id="preprocess-data" class="section level2">
<h2><span class="header-section-number">4.5</span> Preprocess Data</h2>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="4-data-modeling.html#cb96-1"></a>preprocessing_recipe &lt;-</span>
<span id="cb96-2"><a href="4-data-modeling.html#cb96-2"></a><span class="st">  </span><span class="kw">recipe</span>(inducted <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> <span class="kw">training</span>(hof_initial_split)) <span class="op">%&gt;%</span></span>
<span id="cb96-3"><a href="4-data-modeling.html#cb96-3"></a><span class="st">  </span><span class="kw">step_knnimpute</span>(<span class="kw">all_numeric</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb96-4"><a href="4-data-modeling.html#cb96-4"></a><span class="st">  </span><span class="kw">step_center</span>(<span class="kw">all_numeric</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb96-5"><a href="4-data-modeling.html#cb96-5"></a><span class="st">  </span><span class="kw">step_scale</span>(<span class="kw">all_numeric</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb96-6"><a href="4-data-modeling.html#cb96-6"></a><span class="st">  </span><span class="kw">step_rm</span>(player_id) <span class="op">%&gt;%</span></span>
<span id="cb96-7"><a href="4-data-modeling.html#cb96-7"></a><span class="st">  </span><span class="kw">prep</span>()</span>
<span id="cb96-8"><a href="4-data-modeling.html#cb96-8"></a>preprocessing_recipe</span></code></pre></div>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor         18
## 
## Training data contained 1118 data points and no missing data.
## 
## Operations:
## 
## K-nearest neighbor imputation for player_id, ab, r, h, x2b, x3b, hr, rbi, sb, cs, ... [trained]
## Centering for g, ab, r, h, x2b, x3b, hr, rbi, sb, cs, bb, so, ... [trained]
## Scaling for g, ab, r, h, x2b, x3b, hr, rbi, sb, cs, bb, so, ... [trained]
## Variables removed player_id [trained]</code></pre>
</div>
<div id="apply-preprocessing" class="section level2">
<h2><span class="header-section-number">4.6</span> Apply Preprocessing</h2>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="4-data-modeling.html#cb98-1"></a>hof_training_preprocessed_tbl =<span class="st"> </span></span>
<span id="cb98-2"><a href="4-data-modeling.html#cb98-2"></a><span class="st">  </span>preprocessing_recipe <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb98-3"><a href="4-data-modeling.html#cb98-3"></a><span class="st">  </span><span class="kw">bake</span>(<span class="kw">training</span>(hof_initial_split))</span>
<span id="cb98-4"><a href="4-data-modeling.html#cb98-4"></a></span>
<span id="cb98-5"><a href="4-data-modeling.html#cb98-5"></a>hof_training_preprocessed_tbl</span></code></pre></div>
<pre><code>## # A tibble: 1,118 x 18
##         g      ab       r       h     x2b      x3b      hr    rbi     sb     cs     bb
##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1  3.96   3.72    3.93    3.84    3.27    1.08e+0  5.51    4.55   0.786  0.783  2.89 
##  2 -0.873 -0.702  -1.08   -0.770  -0.790  -8.61e-1 -0.556  -0.939 -0.701 -0.323 -1.11 
##  3 -0.610 -0.702  -0.489  -0.669  -0.570  -1.22e-1 -0.730  -1.12  -0.433 -0.298 -0.421
##  4 -0.286  0.113   0.217   0.179  -0.0318 -1.47e-1 -0.974  -0.859  0.180  0.205 -0.290
##  5  0.925  0.670   0.158   0.589   0.374  -4.67e-1  1.87    1.21  -0.764 -0.423  0.182
##  6 -0.954 -0.759  -0.582  -0.809  -0.728  -6.64e-1  0.0781 -0.748  0.272  0.984 -0.662
##  7 -1.07  -1.22   -1.30   -1.30   -1.27    5.94e-4 -0.861  -1.08  -0.299 -0.649 -0.927
##  8 -0.101  0.0222  0.0300  0.0853  0.259  -8.85e-1  0.217   0.136 -0.532 -0.624  0.189
##  9 -0.474 -0.728  -0.601  -0.755  -0.561  -2.40e-2 -0.643  -0.780 -0.334  0.205 -0.133
## 10 -0.932 -1.03   -1.14   -1.12   -0.993  -8.12e-1 -0.417  -0.981 -0.813 -0.649 -0.568
## # ... with 1,108 more rows, and 7 more variables: so &lt;dbl&gt;, ibb &lt;dbl&gt;, hbp &lt;dbl&gt;,
## #   sh &lt;dbl&gt;, sf &lt;dbl&gt;, gidp &lt;dbl&gt;, inducted &lt;fct&gt;</code></pre>
</div>
<div id="prepare-cross-validation" class="section level2">
<h2><span class="header-section-number">4.7</span> Prepare Cross Validation</h2>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="4-data-modeling.html#cb100-1"></a><span class="kw">set.seed</span>(<span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(<span class="st">&quot;beatnavy&quot;</span>)))</span>
<span id="cb100-2"><a href="4-data-modeling.html#cb100-2"></a>hof_cv_folds =</span>
<span id="cb100-3"><a href="4-data-modeling.html#cb100-3"></a><span class="st">  </span><span class="kw">training</span>(hof_initial_split) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb100-4"><a href="4-data-modeling.html#cb100-4"></a><span class="st">    </span><span class="kw">bake</span>(preprocessing_recipe, <span class="dt">new_data =</span> .) <span class="op">%&gt;%</span></span>
<span id="cb100-5"><a href="4-data-modeling.html#cb100-5"></a><span class="st">    </span><span class="kw">vfold_cv</span>(<span class="dt">v =</span> <span class="dv">5</span>)</span>
<span id="cb100-6"><a href="4-data-modeling.html#cb100-6"></a>hof_cv_folds</span></code></pre></div>
<pre><code>## #  5-fold cross-validation 
## # A tibble: 5 x 2
##   splits            id   
##   &lt;named list&gt;      &lt;chr&gt;
## 1 &lt;split [894/224]&gt; Fold1
## 2 &lt;split [894/224]&gt; Fold2
## 3 &lt;split [894/224]&gt; Fold3
## 4 &lt;split [895/223]&gt; Fold4
## 5 &lt;split [895/223]&gt; Fold5</code></pre>
</div>
<div id="specify-models" class="section level2">
<h2><span class="header-section-number">4.8</span> Specify Models</h2>
<div id="glm-model" class="section level3 unnumbered">
<h3>GLM Model</h3>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="4-data-modeling.html#cb102-1"></a>glmnet_model =</span>
<span id="cb102-2"><a href="4-data-modeling.html#cb102-2"></a><span class="st">  </span><span class="kw">logistic_reg</span>(<span class="dt">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb102-3"><a href="4-data-modeling.html#cb102-3"></a>    <span class="dt">penalty =</span> <span class="kw">tune</span>(),</span>
<span id="cb102-4"><a href="4-data-modeling.html#cb102-4"></a>    <span class="dt">mixture =</span> <span class="kw">tune</span>()) <span class="op">%&gt;%</span></span>
<span id="cb102-5"><a href="4-data-modeling.html#cb102-5"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb102-6"><a href="4-data-modeling.html#cb102-6"></a></span>
<span id="cb102-7"><a href="4-data-modeling.html#cb102-7"></a>glmnet_model</span></code></pre></div>
<pre><code>## Logistic Regression Model Specification (classification)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = tune()
## 
## Computational engine: glmnet</code></pre>
</div>
<div id="random-forest-model" class="section level3 unnumbered">
<h3>Random Forest Model</h3>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="4-data-modeling.html#cb104-1"></a>forest_model =</span>
<span id="cb104-2"><a href="4-data-modeling.html#cb104-2"></a><span class="st">  </span><span class="kw">rand_forest</span>(</span>
<span id="cb104-3"><a href="4-data-modeling.html#cb104-3"></a>    <span class="dt">mode =</span> <span class="st">&quot;classification&quot;</span>,</span>
<span id="cb104-4"><a href="4-data-modeling.html#cb104-4"></a>    <span class="dt">mtry =</span> <span class="kw">tune</span>(),</span>
<span id="cb104-5"><a href="4-data-modeling.html#cb104-5"></a>    <span class="dt">trees =</span> <span class="kw">tune</span>(),</span>
<span id="cb104-6"><a href="4-data-modeling.html#cb104-6"></a>    <span class="dt">min_n =</span> <span class="kw">tune</span>()</span>
<span id="cb104-7"><a href="4-data-modeling.html#cb104-7"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb104-8"><a href="4-data-modeling.html#cb104-8"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;randomForest&quot;</span>, <span class="dt">objective =</span> <span class="st">&quot;reg:squarederror&quot;</span>)</span>
<span id="cb104-9"><a href="4-data-modeling.html#cb104-9"></a></span>
<span id="cb104-10"><a href="4-data-modeling.html#cb104-10"></a>forest_model</span></code></pre></div>
<pre><code>## Random Forest Model Specification (classification)
## 
## Main Arguments:
##   mtry = tune()
##   trees = tune()
##   min_n = tune()
## 
## Engine-Specific Arguments:
##   objective = reg:squarederror
## 
## Computational engine: randomForest</code></pre>
</div>
</div>
<div id="create-grid-of-parameters-to-validate-over" class="section level2">
<h2><span class="header-section-number">4.9</span> Create Grid of Parameters to Validate Over</h2>
<div id="glm-model-1" class="section level3 unnumbered">
<h3>GLM Model</h3>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="4-data-modeling.html#cb106-1"></a>glmnet_params =<span class="st"> </span><span class="kw">parameters</span>(<span class="kw">penalty</span>(), <span class="kw">mixture</span>())</span>
<span id="cb106-2"><a href="4-data-modeling.html#cb106-2"></a>glmnet_params</span></code></pre></div>
<pre><code>## Collection of 2 parameters for tuning
## 
##       id parameter type object class
##  penalty        penalty    nparam[+]
##  mixture        mixture    nparam[+]</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="4-data-modeling.html#cb108-1"></a><span class="kw">set.seed</span>(<span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(<span class="st">&quot;beatnavy&quot;</span>)))</span>
<span id="cb108-2"><a href="4-data-modeling.html#cb108-2"></a>glmnet_grid &lt;-<span class="st"> </span><span class="kw">grid_max_entropy</span>(glmnet_params, <span class="dt">size =</span> <span class="dv">20</span>)</span>
<span id="cb108-3"><a href="4-data-modeling.html#cb108-3"></a>glmnet_grid</span></code></pre></div>
<pre><code>## # A tibble: 20 x 2
##     penalty mixture
##       &lt;dbl&gt;   &lt;dbl&gt;
##  1 1.77e- 9  0.508 
##  2 2.24e- 2  0.0442
##  3 4.54e-10  0.852 
##  4 1.93e- 8  0.206 
##  5 5.17e- 2  0.988 
##  6 4.62e- 9  0.0242
##  7 1.94e- 6  0.338 
##  8 8.83e- 1  0.608 
##  9 8.52e- 3  0.597 
## 10 1.23e-10  0.105 
## 11 2.40e-10  0.313 
## 12 5.91e- 8  0.694 
## 13 8.03e- 8  0.936 
## 14 1.32e- 2  0.350 
## 15 8.91e- 6  0.515 
## 16 1.66e- 4  0.915 
## 17 1.44e- 4  0.702 
## 18 1.38e- 6  0.0159
## 19 1.35e-10  0.643 
## 20 7.04e- 4  0.196</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="4-data-modeling.html#cb110-1"></a>glmnet_grid <span class="op">%&gt;%</span></span>
<span id="cb110-2"><a href="4-data-modeling.html#cb110-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(penalty, mixture)) <span class="op">+</span></span>
<span id="cb110-3"><a href="4-data-modeling.html#cb110-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb110-4"><a href="4-data-modeling.html#cb110-4"></a><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb110-5"><a href="4-data-modeling.html#cb110-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Max Entropy Grid&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Penalty (log scale)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Mixture&quot;</span>)</span></code></pre></div>
<p><img src="Intermediate_R_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
</div>
<div id="random-forest-model-1" class="section level3 unnumbered">
<h3>Random Forest Model</h3>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="4-data-modeling.html#cb111-1"></a>forest_params &lt;-<span class="st"> </span><span class="kw">parameters</span>(<span class="kw">mtry</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">6</span>)), <span class="kw">trees</span>(), <span class="kw">min_n</span>())</span>
<span id="cb111-2"><a href="4-data-modeling.html#cb111-2"></a>forest_params</span></code></pre></div>
<pre><code>## Collection of 3 parameters for tuning
## 
##     id parameter type object class
##   mtry           mtry    nparam[+]
##  trees          trees    nparam[+]
##  min_n          min_n    nparam[+]</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="4-data-modeling.html#cb113-1"></a><span class="kw">set.seed</span>(<span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(<span class="st">&quot;beatnavy&quot;</span>)))</span>
<span id="cb113-2"><a href="4-data-modeling.html#cb113-2"></a>forest_grid &lt;-<span class="st"> </span><span class="kw">grid_max_entropy</span>(forest_params, <span class="dt">size =</span> <span class="dv">30</span>)</span>
<span id="cb113-3"><a href="4-data-modeling.html#cb113-3"></a>forest_grid</span></code></pre></div>
<pre><code>## # A tibble: 30 x 3
##     mtry trees min_n
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1     2  1264     5
##  2     4  1113    28
##  3     5   622    11
##  4     2    28     6
##  5     3    24    19
##  6     3  1479    36
##  7     4  1404    13
##  8     5    33    40
##  9     6   115    15
## 10     6   686     3
## # ... with 20 more rows</code></pre>
</div>
</div>
<div id="execute-cross-validation" class="section level2">
<h2><span class="header-section-number">4.10</span> Execute Cross Validation</h2>
<div id="glm-model-2" class="section level3 unnumbered">
<h3>GLM Model</h3>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="4-data-modeling.html#cb115-1"></a><span class="kw">library</span>(tune)</span>
<span id="cb115-2"><a href="4-data-modeling.html#cb115-2"></a>glmnet_stage_<span class="dv">1</span>_cv_results_tbl &lt;-<span class="st"> </span><span class="kw">tune_grid</span>(</span>
<span id="cb115-3"><a href="4-data-modeling.html#cb115-3"></a>    <span class="dt">formula   =</span> inducted <span class="op">~</span><span class="st"> </span>.,</span>
<span id="cb115-4"><a href="4-data-modeling.html#cb115-4"></a>    <span class="dt">model     =</span> glmnet_model,</span>
<span id="cb115-5"><a href="4-data-modeling.html#cb115-5"></a>    <span class="dt">resamples =</span> hof_cv_folds,</span>
<span id="cb115-6"><a href="4-data-modeling.html#cb115-6"></a>    <span class="dt">grid      =</span> glmnet_grid,</span>
<span id="cb115-7"><a href="4-data-modeling.html#cb115-7"></a>    <span class="dt">metrics   =</span> <span class="kw">metric_set</span>(accuracy, kap, roc_auc),</span>
<span id="cb115-8"><a href="4-data-modeling.html#cb115-8"></a>    <span class="dt">control   =</span> <span class="kw">control_grid</span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb115-9"><a href="4-data-modeling.html#cb115-9"></a>)</span>
<span id="cb115-10"><a href="4-data-modeling.html#cb115-10"></a></span>
<span id="cb115-11"><a href="4-data-modeling.html#cb115-11"></a>glmnet_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 7
##     penalty mixture .metric  .estimator  mean     n std_err
##       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1 8.83e- 1   0.608 accuracy binary     0.886     5 0.00869
##  2 2.40e-10   0.313 accuracy binary     0.912     5 0.0103 
##  3 1.93e- 8   0.206 accuracy binary     0.912     5 0.0103 
##  4 1.94e- 6   0.338 accuracy binary     0.912     5 0.0103 
##  5 1.44e- 4   0.702 accuracy binary     0.912     5 0.0103 
##  6 1.66e- 4   0.915 accuracy binary     0.912     5 0.0103 
##  7 7.04e- 4   0.196 accuracy binary     0.912     5 0.0118 
##  8 1.35e-10   0.643 accuracy binary     0.913     5 0.00990
##  9 4.54e-10   0.852 accuracy binary     0.913     5 0.00990
## 10 1.77e- 9   0.508 accuracy binary     0.913     5 0.0107</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="4-data-modeling.html#cb117-1"></a>glmnet_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;kap&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 7
##     penalty mixture .metric .estimator  mean     n std_err
##       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1 8.83e- 1  0.608  kap     binary     0         5  0     
##  2 5.17e- 2  0.988  kap     binary     0.374     5  0.0553
##  3 1.32e- 2  0.350  kap     binary     0.492     5  0.0589
##  4 7.04e- 4  0.196  kap     binary     0.496     5  0.0533
##  5 2.24e- 2  0.0442 kap     binary     0.498     5  0.0637
##  6 4.62e- 9  0.0242 kap     binary     0.499     5  0.0551
##  7 2.40e-10  0.313  kap     binary     0.500     5  0.0432
##  8 1.93e- 8  0.206  kap     binary     0.500     5  0.0432
##  9 1.94e- 6  0.338  kap     binary     0.500     5  0.0432
## 10 1.44e- 4  0.702  kap     binary     0.500     5  0.0432</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="4-data-modeling.html#cb119-1"></a>glmnet_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;roc_auc&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 7
##     penalty mixture .metric .estimator  mean     n std_err
##       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1 8.83e- 1  0.608  roc_auc binary     0.5       5  0     
##  2 5.17e- 2  0.988  roc_auc binary     0.901     5  0.0192
##  3 2.24e- 2  0.0442 roc_auc binary     0.919     5  0.0127
##  4 8.03e- 8  0.936  roc_auc binary     0.919     5  0.0120
##  5 4.54e-10  0.852  roc_auc binary     0.919     5  0.0121
##  6 5.91e- 8  0.694  roc_auc binary     0.919     5  0.0121
##  7 1.94e- 6  0.338  roc_auc binary     0.919     5  0.0121
##  8 1.35e-10  0.643  roc_auc binary     0.919     5  0.0121
##  9 1.77e- 9  0.508  roc_auc binary     0.919     5  0.0119
## 10 8.91e- 6  0.515  roc_auc binary     0.919     5  0.0119</code></pre>
</div>
<div id="random-forest-model-2" class="section level3 unnumbered">
<h3>Random Forest Model</h3>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="4-data-modeling.html#cb121-1"></a>forest_stage_<span class="dv">1</span>_cv_results_tbl &lt;-<span class="st"> </span><span class="kw">tune_grid</span>(</span>
<span id="cb121-2"><a href="4-data-modeling.html#cb121-2"></a>    <span class="dt">formula   =</span> inducted <span class="op">~</span><span class="st"> </span>.,</span>
<span id="cb121-3"><a href="4-data-modeling.html#cb121-3"></a>    <span class="dt">model     =</span> forest_model,</span>
<span id="cb121-4"><a href="4-data-modeling.html#cb121-4"></a>    <span class="dt">resamples =</span> hof_cv_folds,</span>
<span id="cb121-5"><a href="4-data-modeling.html#cb121-5"></a>    <span class="dt">grid      =</span> forest_grid,</span>
<span id="cb121-6"><a href="4-data-modeling.html#cb121-6"></a>    <span class="dt">metrics   =</span> <span class="kw">metric_set</span>(accuracy, kap, roc_auc),</span>
<span id="cb121-7"><a href="4-data-modeling.html#cb121-7"></a>    <span class="dt">control   =</span> <span class="kw">control_grid</span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb121-8"><a href="4-data-modeling.html#cb121-8"></a>)</span>
<span id="cb121-9"><a href="4-data-modeling.html#cb121-9"></a></span>
<span id="cb121-10"><a href="4-data-modeling.html#cb121-10"></a>forest_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 8
##     mtry trees min_n .metric  .estimator  mean     n std_err
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1     3    24    19 accuracy binary     0.913     5 0.0122 
##  2     2    69    32 accuracy binary     0.914     5 0.0121 
##  3     4  1128     2 accuracy binary     0.916     5 0.00835
##  4     5  1992     5 accuracy binary     0.916     5 0.00798
##  5     3   691    22 accuracy binary     0.916     5 0.00925
##  6     4  1404    13 accuracy binary     0.916     5 0.00947
##  7     6   575    23 accuracy binary     0.916     5 0.00936
##  8     2  1264     5 accuracy binary     0.917     5 0.00979
##  9     2  1986    16 accuracy binary     0.917     5 0.00948
## 10     2   824    38 accuracy binary     0.918     5 0.00960</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="4-data-modeling.html#cb123-1"></a>forest_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;kap&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 8
##     mtry trees min_n .metric .estimator  mean     n std_err
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1     3    24    19 kap     binary     0.478     5  0.0783
##  2     6   575    23 kap     binary     0.498     5  0.0660
##  3     2  1264     5 kap     binary     0.500     5  0.0639
##  4     4  1404    13 kap     binary     0.501     5  0.0608
##  5     2    69    32 kap     binary     0.501     5  0.0756
##  6     2  1986    16 kap     binary     0.504     5  0.0632
##  7     3   691    22 kap     binary     0.508     5  0.0645
##  8     4  1128     2 kap     binary     0.509     5  0.0539
##  9     5  1992     5 kap     binary     0.509     5  0.0496
## 10     2   605    13 kap     binary     0.514     5  0.0606</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="4-data-modeling.html#cb125-1"></a>forest_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;roc_auc&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 8
##     mtry trees min_n .metric .estimator  mean     n std_err
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1     5    33    40 roc_auc binary     0.890     5  0.0236
##  2     3    24    19 roc_auc binary     0.899     5  0.0190
##  3     6   115    15 roc_auc binary     0.910     5  0.0192
##  4     2    28     6 roc_auc binary     0.913     5  0.0171
##  5     6   575    23 roc_auc binary     0.913     5  0.0195
##  6     6   663    38 roc_auc binary     0.916     5  0.0187
##  7     3   379    31 roc_auc binary     0.916     5  0.0159
##  8     2    69    32 roc_auc binary     0.917     5  0.0178
##  9     5   291    22 roc_auc binary     0.917     5  0.0177
## 10     2   824    38 roc_auc binary     0.917     5  0.0164</code></pre>
</div>
</div>
<div id="select-best-parameters" class="section level2">
<h2><span class="header-section-number">4.11</span> Select Best Parameters</h2>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="4-data-modeling.html#cb127-1"></a>params_glmnet_best &lt;-<span class="st"> </span>glmnet_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb127-2"><a href="4-data-modeling.html#cb127-2"></a><span class="st">    </span><span class="kw">select_best</span>(<span class="st">&quot;roc_auc&quot;</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</span>
<span id="cb127-3"><a href="4-data-modeling.html#cb127-3"></a>params_glmnet_best</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   penalty mixture
##     &lt;dbl&gt;   &lt;dbl&gt;
## 1   0.883   0.608</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="4-data-modeling.html#cb129-1"></a>params_forest_best &lt;-<span class="st"> </span>forest_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb129-2"><a href="4-data-modeling.html#cb129-2"></a><span class="st">    </span><span class="kw">select_best</span>(<span class="st">&quot;roc_auc&quot;</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</span>
<span id="cb129-3"><a href="4-data-modeling.html#cb129-3"></a>params_forest_best</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##    mtry trees min_n
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     5    33    40</code></pre>
</div>
<div id="save-best-paramenters" class="section level2">
<h2><span class="header-section-number">4.12</span> Save Best Paramenters</h2>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="4-data-modeling.html#cb131-1"></a>glmnet_stage_<span class="dv">2</span>_model &lt;-<span class="st"> </span>glmnet_model <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-2"><a href="4-data-modeling.html#cb131-2"></a><span class="st">    </span><span class="kw">finalize_model</span>(<span class="dt">parameters =</span> params_glmnet_best)</span>
<span id="cb131-3"><a href="4-data-modeling.html#cb131-3"></a></span>
<span id="cb131-4"><a href="4-data-modeling.html#cb131-4"></a>glmnet_stage_<span class="dv">2</span>_model</span></code></pre></div>
<pre><code>## Logistic Regression Model Specification (classification)
## 
## Main Arguments:
##   penalty = 0.883211000083764
##   mixture = 0.608328476548195
## 
## Computational engine: glmnet</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="4-data-modeling.html#cb133-1"></a>forest_stage_<span class="dv">2</span>_model &lt;-<span class="st"> </span>forest_model <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-2"><a href="4-data-modeling.html#cb133-2"></a><span class="st">    </span><span class="kw">finalize_model</span>(params_forest_best)</span>
<span id="cb133-3"><a href="4-data-modeling.html#cb133-3"></a></span>
<span id="cb133-4"><a href="4-data-modeling.html#cb133-4"></a>forest_stage_<span class="dv">2</span>_model</span></code></pre></div>
<pre><code>## Random Forest Model Specification (classification)
## 
## Main Arguments:
##   mtry = 5
##   trees = 33
##   min_n = 40
## 
## Engine-Specific Arguments:
##   objective = reg:squarederror
## 
## Computational engine: randomForest</code></pre>
</div>
<div id="compare-models" class="section level2">
<h2><span class="header-section-number">4.13</span> Compare Models</h2>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="4-data-modeling.html#cb135-1"></a>train_processed &lt;-<span class="st"> </span></span>
<span id="cb135-2"><a href="4-data-modeling.html#cb135-2"></a><span class="st">  </span><span class="kw">training</span>(hof_initial_split) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-3"><a href="4-data-modeling.html#cb135-3"></a><span class="st">  </span><span class="kw">bake</span>(preprocessing_recipe, <span class="dt">new_data =</span> .)</span>
<span id="cb135-4"><a href="4-data-modeling.html#cb135-4"></a></span>
<span id="cb135-5"><a href="4-data-modeling.html#cb135-5"></a>test_processed  &lt;-<span class="st"> </span></span>
<span id="cb135-6"><a href="4-data-modeling.html#cb135-6"></a><span class="st">  </span><span class="kw">testing</span>(hof_initial_split) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-7"><a href="4-data-modeling.html#cb135-7"></a><span class="st">  </span><span class="kw">bake</span>(preprocessing_recipe, <span class="dt">new_data =</span> .)</span>
<span id="cb135-8"><a href="4-data-modeling.html#cb135-8"></a>    </span>
<span id="cb135-9"><a href="4-data-modeling.html#cb135-9"></a>target_expr &lt;-<span class="st"> </span>preprocessing_recipe <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-10"><a href="4-data-modeling.html#cb135-10"></a><span class="st">    </span><span class="kw">pluck</span>(<span class="st">&quot;last_term_info&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb135-11"><a href="4-data-modeling.html#cb135-11"></a><span class="st">    </span><span class="kw">filter</span>(role <span class="op">==</span><span class="st"> &quot;outcome&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb135-12"><a href="4-data-modeling.html#cb135-12"></a><span class="st">    </span><span class="kw">pull</span>(variable) <span class="op">%&gt;%</span></span>
<span id="cb135-13"><a href="4-data-modeling.html#cb135-13"></a><span class="st">    </span><span class="kw">sym</span>()</span>
<span id="cb135-14"><a href="4-data-modeling.html#cb135-14"></a></span>
<span id="cb135-15"><a href="4-data-modeling.html#cb135-15"></a>glmnet_stage_<span class="dv">2</span>_metrics =<span class="st">    </span></span>
<span id="cb135-16"><a href="4-data-modeling.html#cb135-16"></a><span class="st">  </span>glmnet_stage_<span class="dv">2</span>_model <span class="op">%&gt;%</span></span>
<span id="cb135-17"><a href="4-data-modeling.html#cb135-17"></a><span class="st">  </span><span class="kw">fit</span>(<span class="dt">formula =</span> inducted <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> train_processed) <span class="op">%&gt;%</span></span>
<span id="cb135-18"><a href="4-data-modeling.html#cb135-18"></a><span class="st">  </span><span class="kw">predict</span>(<span class="dt">new_data =</span> test_processed) <span class="op">%&gt;%</span></span>
<span id="cb135-19"><a href="4-data-modeling.html#cb135-19"></a><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">testing</span>(hof_initial_split)) <span class="op">%&gt;%</span></span>
<span id="cb135-20"><a href="4-data-modeling.html#cb135-20"></a><span class="st">  </span><span class="kw">metrics</span>(<span class="op">!!</span><span class="st"> </span>target_expr, .pred_class)</span>
<span id="cb135-21"><a href="4-data-modeling.html#cb135-21"></a></span>
<span id="cb135-22"><a href="4-data-modeling.html#cb135-22"></a>forest_stage_<span class="dv">2</span>_metrics =<span class="st">    </span></span>
<span id="cb135-23"><a href="4-data-modeling.html#cb135-23"></a><span class="st">  </span>forest_stage_<span class="dv">2</span>_model <span class="op">%&gt;%</span></span>
<span id="cb135-24"><a href="4-data-modeling.html#cb135-24"></a><span class="st">  </span><span class="kw">fit</span>(<span class="dt">formula =</span> inducted <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> train_processed) <span class="op">%&gt;%</span></span>
<span id="cb135-25"><a href="4-data-modeling.html#cb135-25"></a><span class="st">  </span><span class="kw">predict</span>(<span class="dt">new_data =</span> test_processed) <span class="op">%&gt;%</span></span>
<span id="cb135-26"><a href="4-data-modeling.html#cb135-26"></a><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">testing</span>(hof_initial_split)) <span class="op">%&gt;%</span></span>
<span id="cb135-27"><a href="4-data-modeling.html#cb135-27"></a><span class="st">  </span><span class="kw">metrics</span>(<span class="op">!!</span><span class="st"> </span>target_expr, .pred_class)</span>
<span id="cb135-28"><a href="4-data-modeling.html#cb135-28"></a></span>
<span id="cb135-29"><a href="4-data-modeling.html#cb135-29"></a>glmnet_stage_<span class="dv">2</span>_metrics <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-30"><a href="4-data-modeling.html#cb135-30"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mod =</span> <span class="st">&quot;glmnet&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-31"><a href="4-data-modeling.html#cb135-31"></a><span class="st">  </span><span class="kw">bind_rows</span>(</span>
<span id="cb135-32"><a href="4-data-modeling.html#cb135-32"></a>    forest_stage_<span class="dv">2</span>_metrics <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-33"><a href="4-data-modeling.html#cb135-33"></a><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">mod =</span> <span class="st">&quot;forest&quot;</span>)</span>
<span id="cb135-34"><a href="4-data-modeling.html#cb135-34"></a>    ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb135-35"><a href="4-data-modeling.html#cb135-35"></a><span class="st">  </span><span class="kw">arrange</span>(.metric,<span class="op">-</span>.estimate)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   .metric  .estimator .estimate mod   
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; 
## 1 accuracy binary         0.900 forest
## 2 accuracy binary         0.857 glmnet
## 3 kap      binary         0.497 forest
## 4 kap      binary         0     glmnet</code></pre>
<p>Looks like the Random Forest is the better model.</p>
</div>
<div id="run-best-model-on-all-data" class="section level2">
<h2><span class="header-section-number">4.14</span> Run Best Model on All Data</h2>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="4-data-modeling.html#cb137-1"></a>model_final &lt;-<span class="st"> </span>forest_stage_<span class="dv">2</span>_model <span class="op">%&gt;%</span></span>
<span id="cb137-2"><a href="4-data-modeling.html#cb137-2"></a><span class="st">    </span><span class="kw">fit</span>(inducted <span class="op">~</span><span class="st"> </span>. , <span class="dt">data =</span> <span class="kw">bake</span>(preprocessing_recipe, <span class="dt">new_data =</span> hofmod))</span></code></pre></div>
</div>
<div id="run-model-on-new-data" class="section level2">
<h2><span class="header-section-number">4.15</span> Run Model on New Data</h2>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="4-data-modeling.html#cb138-1"></a>hoftest <span class="op">%&gt;%</span></span>
<span id="cb138-2"><a href="4-data-modeling.html#cb138-2"></a><span class="st">  </span><span class="kw">bake</span>(preprocessing_recipe, <span class="dt">new_data =</span> .) <span class="op">%&gt;%</span></span>
<span id="cb138-3"><a href="4-data-modeling.html#cb138-3"></a><span class="st">  </span><span class="kw">predict</span>(model_final, <span class="dt">new_data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb138-4"><a href="4-data-modeling.html#cb138-4"></a><span class="st">  </span><span class="kw">bind_cols</span>(hoftest <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(player_id)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb138-5"><a href="4-data-modeling.html#cb138-5"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(.pred_class))</span></code></pre></div>
<pre><code>## # A tibble: 168 x 2
##    .pred_class player_id
##    &lt;fct&gt;       &lt;chr&gt;    
##  1 1           beltrad01
##  2 1           beltrca01
##  3 1           cabremi01
##  4 1           heltoto01
##  5 1           jeterde01
##  6 1           konerpa01
##  7 1           ortizda01
##  8 1           pujolal01
##  9 1           rodrial01
## 10 1           rolliji01
## # ... with 158 more rows</code></pre>
</div>
<div id="variable-importance" class="section level2">
<h2><span class="header-section-number">4.16</span> Variable Importance</h2>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="4-data-modeling.html#cb140-1"></a><span class="kw">vip</span>(model_final) <span class="op">+</span></span>
<span id="cb140-2"><a href="4-data-modeling.html#cb140-2"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Random Forest Model Importance - HOF Prediction&quot;</span>) </span></code></pre></div>
<p><img src="Intermediate_R_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<p><a href="https://www.r-bloggers.com/product-price-prediction-a-tidy-hyperparameter-tuning-and-cross-validation-tutorial/">Many Thanks</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="3-data-visualization.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "none"
}
});
});
</script>

</body>

</html>
