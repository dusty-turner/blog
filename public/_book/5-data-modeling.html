<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Data Modeling | Intermediate R</title>
  <meta name="description" content="5 Data Modeling | Intermediate R" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Data Modeling | Intermediate R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Data Modeling | Intermediate R" />
  
  
  

<meta name="author" content="MAJ Dusty Turner and Robert Ward" />


<meta name="date" content="2020-06-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="4-functional-programming.html"/>
<link rel="next" href="6-text-analysis.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href = "/">Tutorial Home</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Class Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#expectations"><i class="fa fa-check"></i><b>1.1</b> Expectations</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#distance-learning-challenges"><i class="fa fa-check"></i><b>1.2</b> Distance Learning Challenges</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#class-structure"><i class="fa fa-check"></i><b>1.3</b> Class Structure</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#learning-recommendations"><i class="fa fa-check"></i><b>1.4</b> Learning Recommendations</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#class-introductions"><i class="fa fa-check"></i><b>1.5</b> Class Introductions</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#instructors-introduction"><i class="fa fa-check"></i><b>1.6</b> Instructors Introduction</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#course-intent"><i class="fa fa-check"></i><b>1.7</b> Course Intent</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#tidy-ecosystem"><i class="fa fa-check"></i><b>1.8</b> Tidy Ecosystem</a></li>
<li class="chapter" data-level="1.9" data-path="index.html"><a href="index.html#get-course-documents"><i class="fa fa-check"></i><b>1.9</b> Get Course Documents</a></li>
<li class="chapter" data-level="1.10" data-path="index.html"><a href="index.html#prerequisite-packages"><i class="fa fa-check"></i><b>1.10</b> Prerequisite Packages</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html"><i class="fa fa-check"></i><b>2</b> Data Manipulation</a><ul>
<li class="chapter" data-level="2.1" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#read-in-data"><i class="fa fa-check"></i><b>2.1</b> Read in Data</a></li>
<li class="chapter" data-level="2.2" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#analysis-with-dplyr"><i class="fa fa-check"></i><b>2.2</b> Analysis with <code>dplyr</code></a></li>
<li class="chapter" data-level="2.3" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#joins"><i class="fa fa-check"></i><b>2.3</b> Joins</a></li>
<li class="chapter" data-level="2.4" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#other-dplyr-tricks"><i class="fa fa-check"></i><b>2.4</b> Other dplyr Tricks</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-data-visualization.html"><a href="3-data-visualization.html"><i class="fa fa-check"></i><b>3</b> Data Visualization</a><ul>
<li class="chapter" data-level="3.1" data-path="3-data-visualization.html"><a href="3-data-visualization.html#bar-chart"><i class="fa fa-check"></i><b>3.1</b> Bar Chart</a></li>
<li class="chapter" data-level="3.2" data-path="3-data-visualization.html"><a href="3-data-visualization.html#scatter-plot"><i class="fa fa-check"></i><b>3.2</b> Scatter Plot</a></li>
<li class="chapter" data-level="3.3" data-path="3-data-visualization.html"><a href="3-data-visualization.html#animation"><i class="fa fa-check"></i><b>3.3</b> Animation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-functional-programming.html"><a href="4-functional-programming.html"><i class="fa fa-check"></i><b>4</b> Functional Programming</a><ul>
<li class="chapter" data-level="4.1" data-path="4-functional-programming.html"><a href="4-functional-programming.html#an-interesting-question"><i class="fa fa-check"></i><b>4.1</b> An Interesting Question</a></li>
<li class="chapter" data-level="4.2" data-path="4-functional-programming.html"><a href="4-functional-programming.html#a-more-general-question"><i class="fa fa-check"></i><b>4.2</b> A More General Question</a></li>
<li class="chapter" data-level="4.3" data-path="4-functional-programming.html"><a href="4-functional-programming.html#even-more-generally-writing-a-function"><i class="fa fa-check"></i><b>4.3</b> Even More Generally: Writing a Function</a></li>
<li class="chapter" data-level="4.4" data-path="4-functional-programming.html"><a href="4-functional-programming.html#iteration-with-functions-purrr"><i class="fa fa-check"></i><b>4.4</b> Iteration with functions: <code>purrr</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-data-modeling.html"><a href="5-data-modeling.html"><i class="fa fa-check"></i><b>5</b> Data Modeling</a><ul>
<li class="chapter" data-level="5.1" data-path="5-data-modeling.html"><a href="5-data-modeling.html#prapare-data-for-analysis"><i class="fa fa-check"></i><b>5.1</b> Prapare Data For Analysis</a></li>
<li class="chapter" data-level="5.2" data-path="5-data-modeling.html"><a href="5-data-modeling.html#data-exploration"><i class="fa fa-check"></i><b>5.2</b> Data Exploration</a></li>
<li class="chapter" data-level="5.3" data-path="5-data-modeling.html"><a href="5-data-modeling.html#split-data-testtrain"><i class="fa fa-check"></i><b>5.3</b> Split Data test/train</a></li>
<li class="chapter" data-level="5.4" data-path="5-data-modeling.html"><a href="5-data-modeling.html#preprocess-data"><i class="fa fa-check"></i><b>5.4</b> Preprocess Data</a></li>
<li class="chapter" data-level="5.5" data-path="5-data-modeling.html"><a href="5-data-modeling.html#apply-preprocessing"><i class="fa fa-check"></i><b>5.5</b> Apply Preprocessing</a></li>
<li class="chapter" data-level="5.6" data-path="5-data-modeling.html"><a href="5-data-modeling.html#prepare-cross-validation"><i class="fa fa-check"></i><b>5.6</b> Prepare Cross Validation</a></li>
<li class="chapter" data-level="5.7" data-path="5-data-modeling.html"><a href="5-data-modeling.html#specify-models"><i class="fa fa-check"></i><b>5.7</b> Specify Models</a></li>
<li class="chapter" data-level="5.8" data-path="5-data-modeling.html"><a href="5-data-modeling.html#create-grid-of-parameters-to-validate-over"><i class="fa fa-check"></i><b>5.8</b> Create Grid of Parameters to Validate Over</a></li>
<li class="chapter" data-level="5.9" data-path="5-data-modeling.html"><a href="5-data-modeling.html#execute-cross-validation"><i class="fa fa-check"></i><b>5.9</b> Execute Cross Validation</a></li>
<li class="chapter" data-level="5.10" data-path="5-data-modeling.html"><a href="5-data-modeling.html#select-best-parameters"><i class="fa fa-check"></i><b>5.10</b> Select Best Parameters</a></li>
<li class="chapter" data-level="5.11" data-path="5-data-modeling.html"><a href="5-data-modeling.html#save-best-paramenters"><i class="fa fa-check"></i><b>5.11</b> Save Best Paramenters</a></li>
<li class="chapter" data-level="5.12" data-path="5-data-modeling.html"><a href="5-data-modeling.html#compare-models"><i class="fa fa-check"></i><b>5.12</b> Compare Models</a></li>
<li class="chapter" data-level="5.13" data-path="5-data-modeling.html"><a href="5-data-modeling.html#run-best-model-on-all-data"><i class="fa fa-check"></i><b>5.13</b> Run Best Model on All Data</a></li>
<li class="chapter" data-level="5.14" data-path="5-data-modeling.html"><a href="5-data-modeling.html#run-model-on-new-data"><i class="fa fa-check"></i><b>5.14</b> Run Model on New Data</a></li>
<li class="chapter" data-level="5.15" data-path="5-data-modeling.html"><a href="5-data-modeling.html#variable-importance"><i class="fa fa-check"></i><b>5.15</b> Variable Importance</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-text-analysis.html"><a href="6-text-analysis.html"><i class="fa fa-check"></i><b>6</b> Text Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="6-text-analysis.html"><a href="6-text-analysis.html#the-adventures-of-tom-sawyer"><i class="fa fa-check"></i><b>6.1</b> The Adventures of Tom Sawyer</a></li>
<li class="chapter" data-level="6.2" data-path="6-text-analysis.html"><a href="6-text-analysis.html#find-chapter-splits"><i class="fa fa-check"></i><b>6.2</b> Find Chapter Splits</a></li>
<li class="chapter" data-level="6.3" data-path="6-text-analysis.html"><a href="6-text-analysis.html#tokenize-the-book"><i class="fa fa-check"></i><b>6.3</b> Tokenize the Book</a></li>
<li class="chapter" data-level="6.4" data-path="6-text-analysis.html"><a href="6-text-analysis.html#remove-stop-words"><i class="fa fa-check"></i><b>6.4</b> Remove ‘stop words’</a></li>
<li class="chapter" data-level="6.5" data-path="6-text-analysis.html"><a href="6-text-analysis.html#join-sentiments"><i class="fa fa-check"></i><b>6.5</b> Join Sentiments</a></li>
<li class="chapter" data-level="6.6" data-path="6-text-analysis.html"><a href="6-text-analysis.html#descriptive-text-statistics"><i class="fa fa-check"></i><b>6.6</b> Descriptive Text Statistics</a></li>
<li class="chapter" data-level="6.7" data-path="6-text-analysis.html"><a href="6-text-analysis.html#visualizations"><i class="fa fa-check"></i><b>6.7</b> Visualizations</a></li>
<li class="chapter" data-level="6.8" data-path="6-text-analysis.html"><a href="6-text-analysis.html#n-gram-analysis"><i class="fa fa-check"></i><b>6.8</b> N-Gram Analysis</a></li>
<li class="chapter" data-level="6.9" data-path="6-text-analysis.html"><a href="6-text-analysis.html#term-frequency"><i class="fa fa-check"></i><b>6.9</b> Term Frequency</a></li>
<li class="chapter" data-level="6.10" data-path="6-text-analysis.html"><a href="6-text-analysis.html#topic-modeling"><i class="fa fa-check"></i><b>6.10</b> Topic Modeling</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intermediate R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-modeling" class="section level1">
<h1><span class="header-section-number">5</span> Data Modeling</h1>
<p>In the last year or so, <a href="%22https://twitter.com/topepos%22">Max Kuhn</a>, working for RStudio, has developed `tidymodels()’. Tidymodels is a modeling framework that follows tidy coding principles. It provides a streamlined technique for preprocessing data, executing a model, and validating the output.</p>
<p>In this section, you will learn:</p>
<ol style="list-style-type: decimal">
<li>A small amount of data exploration.</li>
<li>The basics of <code>tidymodels</code></li>
</ol>
<ul>
<li>spliting data</li>
<li>runing multiple models</li>
<li>cross validation</li>
<li>selective the best model</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>How to parallelize your code</li>
</ol>
<p>In this section, we will use the following libraries and data:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb163-2" title="2"><span class="kw">library</span>(tidymodels)</a>
<a class="sourceLine" id="cb163-3" title="3"><span class="kw">library</span>(tune)</a>
<a class="sourceLine" id="cb163-4" title="4"><span class="kw">library</span>(janitor)</a>
<a class="sourceLine" id="cb163-5" title="5"><span class="kw">library</span>(doFuture)</a>
<a class="sourceLine" id="cb163-6" title="6"><span class="kw">library</span>(vip)</a>
<a class="sourceLine" id="cb163-7" title="7"></a>
<a class="sourceLine" id="cb163-8" title="8">data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data_sources/Batting.csv&quot;</span>, <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">SF =</span> <span class="kw">col_double</span>(), <span class="dt">GIDP =</span> <span class="kw">col_double</span>())) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb163-9" title="9"><span class="st">  </span><span class="kw">clean_names</span>()</a>
<a class="sourceLine" id="cb163-10" title="10"></a>
<a class="sourceLine" id="cb163-11" title="11">hofdata &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data_sources/HallOfFame.csv&quot;</span>) </a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   playerID = col_character(),
##   yearid = col_double(),
##   votedBy = col_character(),
##   ballots = col_double(),
##   needed = col_double(),
##   votes = col_double(),
##   inducted = col_character(),
##   category = col_character(),
##   needed_note = col_character()
## )</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" title="1"><span class="kw">head</span>(data)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 22
##   player_id year_id stint team_id lg_id     g    ab     r     h   x2b   x3b    hr   rbi    sb    cs    bb    so   ibb   hbp    sh    sf  gidp
##   &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 abercda01    1871     1 TRO     &lt;NA&gt;      1     4     0     0     0     0     0     0     0     0     0     0    NA    NA    NA    NA    NA
## 2 addybo01     1871     1 RC1     &lt;NA&gt;     25   118    30    32     6     0     0    13     8     1     4     0    NA    NA    NA    NA    NA
## 3 allisar01    1871     1 CL1     &lt;NA&gt;     29   137    28    40     4     5     0    19     3     1     2     5    NA    NA    NA    NA    NA
## 4 allisdo01    1871     1 WS3     &lt;NA&gt;     27   133    28    44    10     2     2    27     1     1     0     2    NA    NA    NA    NA    NA
## 5 ansonca01    1871     1 RC1     &lt;NA&gt;     25   120    29    39    11     3     0    16     6     2     2     1    NA    NA    NA    NA    NA
## 6 armstbo01    1871     1 FW1     &lt;NA&gt;     12    49     9    11     2     1     0     5     0     1     0     1    NA    NA    NA    NA    NA</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" title="1"><span class="kw">head</span>(hofdata)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 9
##   playerID  yearid votedBy ballots needed votes inducted category needed_note
##   &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;      
## 1 cobbty01    1936 BBWAA       226    170   222 Y        Player   &lt;NA&gt;       
## 2 ruthba01    1936 BBWAA       226    170   215 Y        Player   &lt;NA&gt;       
## 3 wagneho01   1936 BBWAA       226    170   215 Y        Player   &lt;NA&gt;       
## 4 mathech01   1936 BBWAA       226    170   205 Y        Player   &lt;NA&gt;       
## 5 johnswa01   1936 BBWAA       226    170   189 Y        Player   &lt;NA&gt;       
## 6 lajoina01   1936 BBWAA       226    170   146 N        Player   &lt;NA&gt;</code></pre>
<p>Lets try to develop an informed answer to the question: What baseball statistics are important for a baseball player making the Hall of Fame?</p>
<div id="prapare-data-for-analysis" class="section level2">
<h2><span class="header-section-number">5.1</span> Prapare Data For Analysis</h2>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" title="1">hofdata &lt;-</a>
<a class="sourceLine" id="cb169-2" title="2"><span class="st">  </span>hofdata <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb169-3" title="3"><span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb169-4" title="4"><span class="st">  </span><span class="kw">select</span>(player_id, inducted) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb169-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hof =</span> <span class="kw">ifelse</span>(inducted<span class="op">==</span><span class="st">&quot;Y&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb169-6" title="6"><span class="st">  </span><span class="kw">filter</span>(hof<span class="op">==</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb169-7" title="7"></a>
<a class="sourceLine" id="cb169-8" title="8">hofdata <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">count</span>(inducted)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   inducted     n
##   &lt;chr&gt;    &lt;int&gt;
## 1 Y          317</code></pre>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" title="1">retiredyear &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb171-2" title="2">data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(player_id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb171-4" title="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">lastyear =</span> <span class="kw">max</span>(year_id))</a></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" title="1">retiredyear</a></code></pre></div>
<pre><code>## # A tibble: 18,915 x 2
##    player_id lastyear
##    &lt;chr&gt;        &lt;dbl&gt;
##  1 aardsda01     2015
##  2 aaronha01     1976
##  3 aaronto01     1971
##  4 aasedo01      1990
##  5 abadan01      2006
##  6 abadfe01      2016
##  7 abadijo01     1875
##  8 abbated01     1910
##  9 abbeybe01     1896
## 10 abbeych01     1897
## # ... with 18,905 more rows</code></pre>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" title="1">hof &lt;-</a>
<a class="sourceLine" id="cb175-2" title="2"><span class="st">  </span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb175-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(player_id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb175-4" title="4"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(g<span class="op">:</span>gidp), <span class="kw">list</span>(<span class="op">~</span><span class="kw">sum</span>(.,<span class="dt">na.rm =</span> <span class="ot">TRUE</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb175-5" title="5"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb175-6" title="6"><span class="st">  </span><span class="kw">left_join</span>(retiredyear) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb175-7" title="7"><span class="st">  </span><span class="kw">left_join</span>(hofdata) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb175-8" title="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">inducted =</span> <span class="kw">if_else</span>(inducted<span class="op">==</span><span class="st">&quot;Y&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb175-9" title="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">inducted =</span> <span class="kw">replace_na</span>(inducted, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb175-10" title="10"><span class="st">  </span><span class="kw">filter</span>(g<span class="op">&gt;=</span><span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb175-11" title="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">inducted =</span> <span class="kw">as.factor</span>(inducted)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb175-12" title="12"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>hof)</a></code></pre></div>
<pre><code>## Joining, by = &quot;player_id&quot;</code></pre>
<pre><code>## Joining, by = &quot;player_id&quot;</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" title="1">hof</a></code></pre></div>
<pre><code>## # A tibble: 1,565 x 20
##    player_id     g    ab     r     h   x2b   x3b    hr   rbi    sb    cs    bb    so   ibb   hbp    sh    sf  gidp lastyear inducted
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;   
##  1 aaronha01  3298 12364  2174  3771   624    98   755  2297   240    73  1402  1383   293    32    21   121   328     1976 1       
##  2 abreubo01  2425  8480  1453  2470   574    59   288  1363   400   128  1476  1840   115    33     7    85   165     2014 0       
##  3 adairje01  1165  4019   378  1022   163    19    57   366    29    29   208   499    31    17    41    30   149     1970 0       
##  4 adamsbo03  1281  4019   591  1082   188    49    37   303    67    30   414   447     1    17    78     5    62     1959 0       
##  5 adamssp01  1424  5557   844  1588   249    48     9   394   154    50   453   223     0    28   136     0    14     1934 0       
##  6 adcocjo01  1959  6606   823  1832   295    35   336  1122    20    25   594  1059    55    17    52    35   223     1966 0       
##  7 ageeto01   1129  3912   558   999   170    27   130   433   167    81   342   918    26    34    21    15    99     1973 0       
##  8 ainsmed01  1078  3048   299   707   108    54    22   317    86    16   263   315     0    12    99     0     0     1924 0       
##  9 alfoned01  1506  5385   777  1532   282    18   146   744    53    17   596   617    22    41    31    55   110     2006 0       
## 10 alicelu01  1341  3971   551  1031   189    53    47   422    81    50   500   624    25    48    49    45    74     2002 0       
## # ... with 1,555 more rows</code></pre>
<div id="filter-for-hof-eligable-players" class="section level3 unnumbered">
<h3>Filter for HOF Eligable Players</h3>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" title="1">hof <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb180-2" title="2"><span class="st">  </span><span class="kw">filter</span>(lastyear <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2012</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb180-3" title="3"><span class="st">  </span><span class="kw">count</span>(inducted) </a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   inducted     n
##   &lt;fct&gt;    &lt;int&gt;
## 1 0         1229
## 2 1          168</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" title="1">hofmod &lt;-</a>
<a class="sourceLine" id="cb182-2" title="2">hof <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb182-3" title="3"><span class="st">  </span><span class="kw">filter</span>(lastyear <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2012</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb182-4" title="4"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>lastyear)</a>
<a class="sourceLine" id="cb182-5" title="5">hofmod</a></code></pre></div>
<pre><code>## # A tibble: 1,397 x 19
##    player_id     g    ab     r     h   x2b   x3b    hr   rbi    sb    cs    bb    so   ibb   hbp    sh    sf  gidp inducted
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;   
##  1 aaronha01  3298 12364  2174  3771   624    98   755  2297   240    73  1402  1383   293    32    21   121   328 1       
##  2 adairje01  1165  4019   378  1022   163    19    57   366    29    29   208   499    31    17    41    30   149 0       
##  3 adamsbo03  1281  4019   591  1082   188    49    37   303    67    30   414   447     1    17    78     5    62 0       
##  4 adamssp01  1424  5557   844  1588   249    48     9   394   154    50   453   223     0    28   136     0    14 0       
##  5 adcocjo01  1959  6606   823  1832   295    35   336  1122    20    25   594  1059    55    17    52    35   223 0       
##  6 ageeto01   1129  3912   558   999   170    27   130   433   167    81   342   918    26    34    21    15    99 0       
##  7 ainsmed01  1078  3048   299   707   108    54    22   317    86    16   263   315     0    12    99     0     0 0       
##  8 alfoned01  1506  5385   777  1532   282    18   146   744    53    17   596   617    22    41    31    55   110 0       
##  9 alicelu01  1341  3971   551  1031   189    53    47   422    81    50   500   624    25    48    49    45    74 0       
## 10 allenbe01  1139  3404   357   815   140    21    73   351    13    16   370   424    52     8    24    17    60 0       
## # ... with 1,387 more rows</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" title="1">hoftest &lt;-</a>
<a class="sourceLine" id="cb184-2" title="2">hof <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb184-3" title="3"><span class="st">  </span><span class="kw">filter</span>(lastyear <span class="op">&gt;</span><span class="st"> </span><span class="dv">2012</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb184-4" title="4"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>lastyear,<span class="op">-</span>inducted)</a>
<a class="sourceLine" id="cb184-5" title="5">hoftest</a></code></pre></div>
<pre><code>## # A tibble: 168 x 18
##    player_id     g    ab     r     h   x2b   x3b    hr   rbi    sb    cs    bb    so   ibb   hbp    sh    sf  gidp
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 abreubo01  2425  8480  1453  2470   574    59   288  1363   400   128  1476  1840   115    33     7    85   165
##  2 andruel01  1221  4625   648  1266   207    37    35   436   241    83   408   684     4    34    99    36   114
##  3 aybarer01  1346  4842   606  1324   241    45    51   451   144    58   257   613    16    48    72    37   102
##  4 barmecl01  1186  3805   434   932   208    17    89   415    43    30   216   734    32    60    60    26    54
##  5 bautijo02  1519  5139   878  1311   267    17   308   862    60    26   881  1113    53    66    23    50   152
##  6 bayja01    1278  4505   737  1200   240    30   222   754    95    17   636  1216    38    56     7    54    84
##  7 beltrad01  2720 10295  1428  2942   591    36   445  1571   119    42   775  1584   108    87    14    89   259
##  8 beltrca01  2457  9301  1522  2617   536    78   421  1536   312    49  1051  1693   101    48    18   104   194
##  9 berkmla01  1879  6491  1146  1905   422    30   366  1234    86    48  1201  1300   160    66     1    54   147
## 10 betanyu01  1156  4052   437  1057   218    29    80   457    30    30   143   435    10    10    34    39   110
## # ... with 158 more rows</code></pre>
</div>
</div>
<div id="data-exploration" class="section level2">
<h2><span class="header-section-number">5.2</span> Data Exploration</h2>
<p>Percentage of players in the dataset who are in the HOF</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" title="1">hofmod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(inducted)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   inducted     n
##   &lt;fct&gt;    &lt;int&gt;
## 1 0         1229
## 2 1          168</code></pre>
<p>Visual difference in statistics between HOF and non HOF</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" title="1">hof <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb188-2" title="2"><span class="st">  </span><span class="kw">select</span>(g<span class="op">:</span>gidp, inducted) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb188-3" title="3"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> g<span class="op">:</span>gidp) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb188-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(inducted,name) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb188-5" title="5"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb188-6" title="6">    <span class="dt">lwr_quantile =</span> <span class="kw">quantile</span>(value, <span class="kw">c</span>(.<span class="dv">025</span>)),</a>
<a class="sourceLine" id="cb188-7" title="7">    <span class="dt">median =</span> <span class="kw">quantile</span>(value, <span class="kw">c</span>(.<span class="dv">5</span>)),</a>
<a class="sourceLine" id="cb188-8" title="8">    <span class="dt">upper_quantile =</span> <span class="kw">quantile</span>(value, <span class="kw">c</span>(.<span class="dv">975</span>)),</a>
<a class="sourceLine" id="cb188-9" title="9">            ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb188-10" title="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>inducted,<span class="dt">y=</span>median)) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-11" title="11"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb188-12" title="12"><span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lwr_quantile, <span class="dt">ymax =</span> upper_quantile)) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-13" title="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-14" title="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span> <span class="st">&quot;&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Differences Between HOF and non-HOF&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb188-15" title="15"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;inducted&#39; (override with `.groups` argument)</code></pre>
<p><img src="Intermediate_R_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<p>Well, won’t players who are in the HOF had played longer? Therefore they should have more hits, home runs, etc?</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" title="1">hof <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb190-2" title="2"><span class="st">  </span><span class="kw">select</span>(g, inducted) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb190-3" title="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>g, <span class="dt">fill =</span> inducted)) <span class="op">+</span></a>
<a class="sourceLine" id="cb190-4" title="4"><span class="st">  </span><span class="kw">geom_density</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb190-5" title="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;Games&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;HOF&quot;</span>,</a>
<a class="sourceLine" id="cb190-6" title="6">       <span class="dt">title =</span> <span class="st">&quot;Density of Game / HOF Stats&quot;</span>)</a></code></pre></div>
<p><img src="Intermediate_R_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
<p>Lets look at this for every statistic</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" title="1">hof <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb191-2" title="2"><span class="st">  </span><span class="kw">select</span>(g<span class="op">:</span>gidp, inducted) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb191-3" title="3"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> g<span class="op">:</span>gidp) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb191-4" title="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>value, <span class="dt">fill =</span> inducted)) <span class="op">+</span></a>
<a class="sourceLine" id="cb191-5" title="5"><span class="st">  </span><span class="kw">geom_density</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb191-6" title="6"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb191-7" title="7"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;HOF&quot;</span>,</a>
<a class="sourceLine" id="cb191-8" title="8">       <span class="dt">title =</span> <span class="st">&quot;Density of Stats for Players In/Out of HOF&quot;</span>)</a></code></pre></div>
<p><img src="Intermediate_R_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
</div>
<div id="split-data-testtrain" class="section level2">
<h2><span class="header-section-number">5.3</span> Split Data test/train</h2>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" title="1"><span class="kw">set.seed</span>(<span class="kw">str_length</span>(<span class="st">&quot;beatnavy&quot;</span>))</a>
<a class="sourceLine" id="cb192-2" title="2">hof_initial_split &lt;-<span class="st"> </span><span class="kw">initial_split</span>(hofmod, <span class="dt">prop =</span> <span class="fl">0.80</span>)</a>
<a class="sourceLine" id="cb192-3" title="3">hof_initial_split</a></code></pre></div>
<pre><code>## &lt;1118/279/1397&gt;</code></pre>
</div>
<div id="preprocess-data" class="section level2">
<h2><span class="header-section-number">5.4</span> Preprocess Data</h2>
<p>A recipe is a description of what steps should be applied to a data set in order to get it ready for data analysis.</p>
<p><code>tidymodels</code> / <code>recipes</code> currently offers about 30 ‘steps’. More documentation for the <code>recipes</code> package is <a href="%22https://recipes.tidymodels.org/reference/index.html%22">here</a></p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" title="1">preprocessing_recipe &lt;-</a>
<a class="sourceLine" id="cb194-2" title="2"><span class="st">  </span><span class="kw">recipe</span>(inducted <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> <span class="kw">training</span>(hof_initial_split)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb194-3" title="3"><span class="st">  </span><span class="kw">step_knnimpute</span>(<span class="kw">all_numeric</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb194-4" title="4"><span class="st">  </span><span class="kw">step_center</span>(<span class="kw">all_numeric</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb194-5" title="5"><span class="st">  </span><span class="kw">step_scale</span>(<span class="kw">all_numeric</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb194-6" title="6"><span class="st">  </span><span class="kw">step_rm</span>(player_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb194-7" title="7"><span class="st">  </span><span class="kw">prep</span>()</a>
<a class="sourceLine" id="cb194-8" title="8">preprocessing_recipe</a></code></pre></div>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor         18
## 
## Training data contained 1118 data points and no missing data.
## 
## Operations:
## 
## K-nearest neighbor imputation for player_id, ab, r, h, x2b, x3b, hr, rbi, sb, cs, bb, so, ibb, hbp, sh, sf, gidp, g [trained]
## Centering for g, ab, r, h, x2b, x3b, hr, rbi, sb, cs, bb, so, ibb, hbp, sh, sf, gidp [trained]
## Scaling for g, ab, r, h, x2b, x3b, hr, rbi, sb, cs, bb, so, ibb, hbp, sh, sf, gidp [trained]
## Variables removed player_id [trained]</code></pre>
</div>
<div id="apply-preprocessing" class="section level2">
<h2><span class="header-section-number">5.5</span> Apply Preprocessing</h2>
<p>For a recipe with at least one preprocessing operations that has been trained by <code>recipe()</code>, apply the computations to the data.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" title="1">hof_training_preprocessed_tbl &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb196-2" title="2"><span class="st">  </span>preprocessing_recipe <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb196-3" title="3"><span class="st">  </span><span class="kw">bake</span>(<span class="kw">training</span>(hof_initial_split))</a>
<a class="sourceLine" id="cb196-4" title="4"></a>
<a class="sourceLine" id="cb196-5" title="5">hof_training_preprocessed_tbl</a></code></pre></div>
<pre><code>## # A tibble: 1,118 x 18
##         g      ab       r       h     x2b      x3b      hr    rbi     sb     cs     bb       so     ibb     hbp     sh      sf   gidp inducted
##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;   
##  1  3.88   3.67    3.86    3.80    3.24    1.09     5.38    4.45   0.776  0.819  2.80   1.92     5.50   -0.187  -0.682  3.20    3.43  1       
##  2 -0.870 -0.700  -1.07   -0.769  -0.794  -0.862   -0.551  -0.923 -0.696 -0.314 -1.10  -0.300   -0.0505 -0.624  -0.384  0.0560  0.892 0       
##  3 -0.611 -0.700  -0.488  -0.669  -0.576  -0.121   -0.721  -1.10  -0.431 -0.288 -0.425 -0.431   -0.686  -0.624   0.169 -0.809  -0.342 0       
##  4 -0.293  0.105   0.208   0.172  -0.0415 -0.146   -0.959  -0.845  0.176  0.226 -0.298 -0.994   -0.708  -0.304   1.03  -0.982  -1.02  0       
##  5  0.899  0.655   0.150   0.578   0.361  -0.467    1.82    1.18  -0.759 -0.417  0.163  1.11     0.458  -0.624  -0.219  0.229   1.94  0       
##  6 -0.950 -0.756  -0.579  -0.807  -0.733  -0.665    0.0686 -0.737  0.266  1.02  -0.660  0.754   -0.157  -0.129  -0.682 -0.463   0.183 0       
##  7 -1.06  -1.21   -1.29   -1.29   -1.28    0.00236 -0.849  -1.06  -0.298 -0.649 -0.918 -0.763   -0.708  -0.769   0.482 -0.982  -1.22  0       
##  8 -0.110  0.0153  0.0234  0.0790  0.247  -0.887    0.205   0.128 -0.529 -0.623  0.169 -0.00326 -0.241   0.0746 -0.533  0.921   0.339 0       
##  9 -0.478 -0.725  -0.598  -0.754  -0.567  -0.0223  -0.636  -0.767 -0.333  0.226 -0.144  0.0144  -0.178   0.278  -0.264  0.575  -0.172 0       
## 10 -0.928 -1.02   -1.13   -1.11   -0.996  -0.813   -0.416  -0.965 -0.808 -0.649 -0.569 -0.489    0.395  -0.886  -0.638 -0.394  -0.371 0       
## # ... with 1,108 more rows</code></pre>
</div>
<div id="prepare-cross-validation" class="section level2">
<h2><span class="header-section-number">5.6</span> Prepare Cross Validation</h2>
<p>This partitions our data into <code>v</code> folds. In our case, 5.</p>
<p>This yields a data frame with a nested list of training / testing data.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" title="1"><span class="kw">set.seed</span>(<span class="kw">str_length</span>(<span class="st">&quot;beatnavy&quot;</span>))</a>
<a class="sourceLine" id="cb198-2" title="2">hof_cv_folds &lt;-</a>
<a class="sourceLine" id="cb198-3" title="3"><span class="st">  </span><span class="kw">training</span>(hof_initial_split) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb198-4" title="4"><span class="st">    </span><span class="kw">bake</span>(preprocessing_recipe, <span class="dt">new_data =</span> .) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb198-5" title="5"><span class="st">    </span><span class="kw">vfold_cv</span>(<span class="dt">v =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb198-6" title="6">hof_cv_folds</a></code></pre></div>
<pre><code>## #  5-fold cross-validation 
## # A tibble: 5 x 2
##   splits            id   
##   &lt;named list&gt;      &lt;chr&gt;
## 1 &lt;split [894/224]&gt; Fold1
## 2 &lt;split [894/224]&gt; Fold2
## 3 &lt;split [894/224]&gt; Fold3
## 4 &lt;split [895/223]&gt; Fold4
## 5 &lt;split [895/223]&gt; Fold5</code></pre>
</div>
<div id="specify-models" class="section level2">
<h2><span class="header-section-number">5.7</span> Specify Models</h2>
<p>Now that we’ve prepared our data, we must specifiy the models which want to compare. We’ll look at 2.</p>
<p>You must first specify the model type (<code>logistic_reg()</code> and <code>rand_forest</code> in the examples below.) There are many to choose from in the parsnip package. Documentation can be found <a href="%22tidyverse.org/blog/2018/11/parsnip-0-0-1/%22">here</a>.</p>
<p>The motivation behind this package from the documentation, "Modeling functions across different R packages can have very different interfaces. If you would like to try different approaches, there is a lot of syntactical minutiae to remember. The problem worsens when you move in-between platforms.</p>
<p>“<code>parsnip</code> tries to solve this by providing similar interfaces to models. For example, if you are fitting a random forest model and would like to adjust the number of trees in the forest there are different argument names to remember depending on the random forest package you chose…” (such as <code>rf</code> or <code>randomforest</code>).</p>
<p>After you specify the model type, you can provide</p>
<div id="glm-model" class="section level3 unnumbered">
<h3>GLM Model</h3>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" title="1">glmnet_model &lt;-</a>
<a class="sourceLine" id="cb200-2" title="2"><span class="st">  </span><span class="kw">logistic_reg</span>(<span class="dt">mode =</span> <span class="st">&quot;classification&quot;</span>,</a>
<a class="sourceLine" id="cb200-3" title="3">    <span class="dt">penalty =</span> <span class="kw">tune</span>(),</a>
<a class="sourceLine" id="cb200-4" title="4">    <span class="dt">mixture =</span> <span class="kw">tune</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb200-5" title="5"><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>)</a>
<a class="sourceLine" id="cb200-6" title="6"></a>
<a class="sourceLine" id="cb200-7" title="7">glmnet_model</a></code></pre></div>
<pre><code>## Logistic Regression Model Specification (classification)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = tune()
## 
## Computational engine: glmnet</code></pre>
</div>
<div id="random-forest-model" class="section level3 unnumbered">
<h3>Random Forest Model</h3>
<p>Notice how in the previous model and in this model, I did not speciy the parameters such as <code>penalty</code>, <code>mixture</code>, <code>mode</code>, <code>mtry</code>, <code>trees</code>, and <code>min_n</code>. I can specivy these values, but I have chose to ‘tune’ them through cross validation in later steps.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" title="1">forest_model &lt;-</a>
<a class="sourceLine" id="cb202-2" title="2"><span class="st">  </span><span class="kw">rand_forest</span>(</a>
<a class="sourceLine" id="cb202-3" title="3">    <span class="dt">mode =</span> <span class="st">&quot;classification&quot;</span>,</a>
<a class="sourceLine" id="cb202-4" title="4">    <span class="dt">mtry =</span> <span class="kw">tune</span>(),</a>
<a class="sourceLine" id="cb202-5" title="5">    <span class="dt">trees =</span> <span class="kw">tune</span>(),</a>
<a class="sourceLine" id="cb202-6" title="6">    <span class="dt">min_n =</span> <span class="kw">tune</span>()</a>
<a class="sourceLine" id="cb202-7" title="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb202-8" title="8"><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;randomForest&quot;</span>, <span class="dt">objective =</span> <span class="st">&quot;reg:squarederror&quot;</span>)</a>
<a class="sourceLine" id="cb202-9" title="9"></a>
<a class="sourceLine" id="cb202-10" title="10">forest_model</a></code></pre></div>
<pre><code>## Random Forest Model Specification (classification)
## 
## Main Arguments:
##   mtry = tune()
##   trees = tune()
##   min_n = tune()
## 
## Engine-Specific Arguments:
##   objective = reg:squarederror
## 
## Computational engine: randomForest</code></pre>
</div>
</div>
<div id="create-grid-of-parameters-to-validate-over" class="section level2">
<h2><span class="header-section-number">5.8</span> Create Grid of Parameters to Validate Over</h2>
<p>Here we specify the tuning parameters for cross validation and take a look visually at the parameter space we are covering in efforts to reach the best model.</p>
<div id="glm-model-1" class="section level3 unnumbered">
<h3>GLM Model</h3>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" title="1">glmnet_params &lt;-<span class="st"> </span><span class="kw">parameters</span>(<span class="kw">penalty</span>(), <span class="kw">mixture</span>())</a>
<a class="sourceLine" id="cb204-2" title="2">glmnet_params</a></code></pre></div>
<pre><code>## Collection of 2 parameters for tuning
## 
##       id parameter type object class
##  penalty        penalty    nparam[+]
##  mixture        mixture    nparam[+]</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" title="1"><span class="kw">set.seed</span>(<span class="kw">str_length</span>(<span class="st">&quot;beatnavy&quot;</span>))</a>
<a class="sourceLine" id="cb206-2" title="2">glmnet_grid =<span class="st"> </span><span class="kw">grid_max_entropy</span>(glmnet_params, <span class="dt">size =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb206-3" title="3">glmnet_grid</a></code></pre></div>
<pre><code>## # A tibble: 20 x 2
##     penalty mixture
##       &lt;dbl&gt;   &lt;dbl&gt;
##  1 6.31e- 9  0.558 
##  2 3.73e- 4  0.368 
##  3 2.05e- 9  0.805 
##  4 1.71e-10  0.0903
##  5 6.00e- 1  0.620 
##  6 2.15e- 8  0.195 
##  7 1.72e- 2  0.850 
##  8 1.78e-10  0.317 
##  9 8.94e- 4  0.947 
## 10 5.45e- 7  0.809 
## 11 3.69e- 5  0.0202
## 12 3.71e- 2  0.0778
## 13 3.01e- 7  0.993 
## 14 2.49e- 4  0.703 
## 15 2.49e- 8  0.0277
## 16 9.08e- 7  0.532 
## 17 3.13e- 1  0.344 
## 18 3.80e-10  0.671 
## 19 6.00e- 7  0.294 
## 20 4.37e- 4  0.176</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" title="1">glmnet_grid <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb208-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(penalty, mixture)) <span class="op">+</span></a>
<a class="sourceLine" id="cb208-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb208-4" title="4"><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb208-5" title="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Max Entropy Grid&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Penalty (log scale)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Mixture&quot;</span>)</a></code></pre></div>
<p><img src="Intermediate_R_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
</div>
<div id="random-forest-model-1" class="section level3 unnumbered">
<h3>Random Forest Model</h3>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" title="1">forest_params &lt;-<span class="st"> </span><span class="kw">parameters</span>(<span class="kw">mtry</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">6</span>)), <span class="kw">trees</span>(), <span class="kw">min_n</span>())</a>
<a class="sourceLine" id="cb209-2" title="2">forest_params</a></code></pre></div>
<pre><code>## Collection of 3 parameters for tuning
## 
##     id parameter type object class
##   mtry           mtry    nparam[+]
##  trees          trees    nparam[+]
##  min_n          min_n    nparam[+]</code></pre>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" title="1"><span class="kw">set.seed</span>(<span class="kw">str_length</span>(<span class="st">&quot;beatnavy&quot;</span>))</a>
<a class="sourceLine" id="cb211-2" title="2">forest_grid &lt;-<span class="st"> </span><span class="kw">grid_max_entropy</span>(forest_params, <span class="dt">size =</span> <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb211-3" title="3">forest_grid</a></code></pre></div>
<pre><code>## # A tibble: 30 x 3
##     mtry trees min_n
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1     3  1714     5
##  2     4   368    28
##  3     3  1607    39
##  4     3  1207    14
##  5     5    42    37
##  6     4   892    27
##  7     3  1154    25
##  8     5  1678     2
##  9     4   607    10
## 10     3   803    37
## # ... with 20 more rows</code></pre>
</div>
</div>
<div id="execute-cross-validation" class="section level2">
<h2><span class="header-section-number">5.9</span> Execute Cross Validation</h2>
<div id="parallel-processing" class="section level3">
<h3><span class="header-section-number">5.9.1</span> Parallel Processing</h3>
<p>The great thing about cross validation is that it helps tune our parameters in efforts to find the model that performs the best on the out of sample test set. The problem is that it can be compuationally intensive.</p>
<p>Thankfully <code>tidymodels</code> is capable of running over multiple cores. You can see from the code below my computer has 4 cores. Your milage may vary.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" title="1">all_cores &lt;-<span class="st"> </span>parallel<span class="op">::</span><span class="kw">detectCores</span>(<span class="dt">logical =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb213-2" title="2"></a>
<a class="sourceLine" id="cb213-3" title="3"><span class="kw">registerDoFuture</span>()</a>
<a class="sourceLine" id="cb213-4" title="4">cl &lt;-<span class="st"> </span><span class="kw">makeCluster</span>(all_cores)</a>
<a class="sourceLine" id="cb213-5" title="5"><span class="kw">plan</span>(cluster, <span class="dt">workers =</span> cl)</a></code></pre></div>
</div>
<div id="glm-model-2" class="section level3 unnumbered">
<h3>GLM Model</h3>
<p>The code below kicks off the cross validation of your model. You can see the time it took to run the code below.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" title="1">tictoc<span class="op">::</span><span class="kw">tic</span>()</a>
<a class="sourceLine" id="cb214-2" title="2">glmnet_stage_<span class="dv">1</span>_cv_results_tbl &lt;-<span class="st"> </span><span class="kw">tune_grid</span>(</a>
<a class="sourceLine" id="cb214-3" title="3">          <span class="dt">object =</span> glmnet_model, </a>
<a class="sourceLine" id="cb214-4" title="4">          inducted <span class="op">~</span><span class="st"> </span>., </a>
<a class="sourceLine" id="cb214-5" title="5">          <span class="dt">resamples =</span> hof_cv_folds, </a>
<a class="sourceLine" id="cb214-6" title="6">          <span class="dt">grid =</span> glmnet_grid, </a>
<a class="sourceLine" id="cb214-7" title="7">          <span class="co"># grid = forest_grid, </span></a>
<a class="sourceLine" id="cb214-8" title="8">          <span class="dt">metrics =</span> <span class="kw">metric_set</span>(accuracy, kap, roc_auc), </a>
<a class="sourceLine" id="cb214-9" title="9">          <span class="dt">control =</span> <span class="kw">control_grid</span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb214-10" title="10">          )</a>
<a class="sourceLine" id="cb214-11" title="11">tictoc<span class="op">::</span><span class="kw">toc</span>()</a></code></pre></div>
<pre><code>## 26.06 sec elapsed</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" title="1">glmnet_stage_<span class="dv">1</span>_cv_results_tbl</a></code></pre></div>
<pre><code>## #  5-fold cross-validation 
## # A tibble: 5 x 4
##   splits            id    .metrics          .notes          
## * &lt;named list&gt;      &lt;chr&gt; &lt;list&gt;            &lt;list&gt;          
## 1 &lt;split [894/224]&gt; Fold1 &lt;tibble [60 x 5]&gt; &lt;tibble [0 x 1]&gt;
## 2 &lt;split [894/224]&gt; Fold2 &lt;tibble [60 x 5]&gt; &lt;tibble [0 x 1]&gt;
## 3 &lt;split [894/224]&gt; Fold3 &lt;tibble [60 x 5]&gt; &lt;tibble [0 x 1]&gt;
## 4 &lt;split [895/223]&gt; Fold4 &lt;tibble [60 x 5]&gt; &lt;tibble [0 x 1]&gt;
## 5 &lt;split [895/223]&gt; Fold5 &lt;tibble [60 x 5]&gt; &lt;tibble [0 x 1]&gt;</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" title="1">glmnet_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 7
##     penalty mixture .metric  .estimator  mean     n std_err
##       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1 3.69e- 5  0.0202 accuracy binary     0.913     5 0.0106 
##  2 3.01e- 7  0.993  accuracy binary     0.912     5 0.00757
##  3 1.72e- 2  0.850  accuracy binary     0.911     5 0.0120 
##  4 2.49e- 4  0.703  accuracy binary     0.911     5 0.00780
##  5 8.94e- 4  0.947  accuracy binary     0.911     5 0.00964
##  6 3.73e- 4  0.368  accuracy binary     0.911     5 0.00866
##  7 6.00e- 7  0.294  accuracy binary     0.911     5 0.00685
##  8 2.49e- 8  0.0277 accuracy binary     0.911     5 0.00895
##  9 4.37e- 4  0.176  accuracy binary     0.911     5 0.00895
## 10 1.71e-10  0.0903 accuracy binary     0.911     5 0.00837</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" title="1">glmnet_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;kap&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 7
##     penalty mixture .metric .estimator  mean     n std_err
##       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1 3.69e- 5  0.0202 kap     binary     0.539     5  0.0625
##  2 3.01e- 7  0.993  kap     binary     0.531     5  0.0544
##  3 6.00e- 7  0.294  kap     binary     0.528     5  0.0526
##  4 3.73e- 4  0.368  kap     binary     0.527     5  0.0558
##  5 2.49e- 4  0.703  kap     binary     0.527     5  0.0528
##  6 8.94e- 4  0.947  kap     binary     0.526     5  0.0567
##  7 1.71e-10  0.0903 kap     binary     0.524     5  0.0551
##  8 1.78e-10  0.317  kap     binary     0.523     5  0.0509
##  9 3.80e-10  0.671  kap     binary     0.523     5  0.0509
## 10 2.05e- 9  0.805  kap     binary     0.523     5  0.0509</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" title="1">glmnet_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;roc_auc&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 7
##     penalty mixture .metric .estimator  mean     n std_err
##       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1 1.71e-10  0.0903 roc_auc binary     0.912     5  0.0167
##  2 3.73e- 4  0.368  roc_auc binary     0.912     5  0.0168
##  3 4.37e- 4  0.176  roc_auc binary     0.912     5  0.0165
##  4 2.15e- 8  0.195  roc_auc binary     0.912     5  0.0166
##  5 2.49e- 8  0.0277 roc_auc binary     0.911     5  0.0163
##  6 6.00e- 7  0.294  roc_auc binary     0.911     5  0.0165
##  7 3.80e-10  0.671  roc_auc binary     0.911     5  0.0164
##  8 9.08e- 7  0.532  roc_auc binary     0.911     5  0.0163
##  9 6.31e- 9  0.558  roc_auc binary     0.911     5  0.0163
## 10 2.05e- 9  0.805  roc_auc binary     0.911     5  0.0165</code></pre>
</div>
<div id="random-forest-model-2" class="section level3 unnumbered">
<h3>Random Forest Model</h3>
<p>This code took quite a bit of time - but would have been much longer if not parrallelized.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" title="1">tictoc<span class="op">::</span><span class="kw">tic</span>()</a>
<a class="sourceLine" id="cb224-2" title="2">forest_stage_<span class="dv">1</span>_cv_results_tbl &lt;-<span class="st"> </span><span class="kw">tune_grid</span>(</a>
<a class="sourceLine" id="cb224-3" title="3">    <span class="dt">formula   =</span> inducted <span class="op">~</span><span class="st"> </span>.,</a>
<a class="sourceLine" id="cb224-4" title="4">    <span class="dt">model     =</span> forest_model,</a>
<a class="sourceLine" id="cb224-5" title="5">    <span class="dt">resamples =</span> hof_cv_folds,</a>
<a class="sourceLine" id="cb224-6" title="6">    <span class="dt">grid      =</span> forest_grid,</a>
<a class="sourceLine" id="cb224-7" title="7">    <span class="dt">metrics   =</span> <span class="kw">metric_set</span>(accuracy, kap, roc_auc),</a>
<a class="sourceLine" id="cb224-8" title="8">    <span class="dt">control   =</span> <span class="kw">control_grid</span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb224-9" title="9">)</a>
<a class="sourceLine" id="cb224-10" title="10">tictoc<span class="op">::</span><span class="kw">toc</span>()</a></code></pre></div>
<pre><code>## 70.32 sec elapsed</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" title="1">forest_stage_<span class="dv">1</span>_cv_results_tbl</a></code></pre></div>
<pre><code>## #  5-fold cross-validation 
## # A tibble: 5 x 4
##   splits            id    .metrics          .notes          
## * &lt;named list&gt;      &lt;chr&gt; &lt;list&gt;            &lt;list&gt;          
## 1 &lt;split [894/224]&gt; Fold1 &lt;tibble [90 x 6]&gt; &lt;tibble [0 x 1]&gt;
## 2 &lt;split [894/224]&gt; Fold2 &lt;tibble [90 x 6]&gt; &lt;tibble [0 x 1]&gt;
## 3 &lt;split [894/224]&gt; Fold3 &lt;tibble [90 x 6]&gt; &lt;tibble [0 x 1]&gt;
## 4 &lt;split [895/223]&gt; Fold4 &lt;tibble [90 x 6]&gt; &lt;tibble [0 x 1]&gt;
## 5 &lt;split [895/223]&gt; Fold5 &lt;tibble [90 x 6]&gt; &lt;tibble [0 x 1]&gt;</code></pre>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" title="1">forest_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 8
##     mtry trees min_n .metric  .estimator  mean     n std_err
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1     6  1096    13 accuracy binary     0.919     5 0.00777
##  2     4   906    16 accuracy binary     0.919     5 0.00889
##  3     2   102    21 accuracy binary     0.918     5 0.00845
##  4     5  1974    13 accuracy binary     0.918     5 0.00771
##  5     3  1207    14 accuracy binary     0.918     5 0.00858
##  6     4   368    28 accuracy binary     0.917     5 0.00758
##  7     4   607    10 accuracy binary     0.917     5 0.00835
##  8     3   985    11 accuracy binary     0.917     5 0.00948
##  9     3   579    14 accuracy binary     0.916     5 0.00867
## 10     3   877     3 accuracy binary     0.916     5 0.00913</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" title="1">forest_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;kap&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 8
##     mtry trees min_n .metric .estimator  mean     n std_err
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1     6  1096    13 kap     binary     0.575     5  0.0478
##  2     4   906    16 kap     binary     0.571     5  0.0488
##  3     2   102    21 kap     binary     0.568     5  0.0546
##  4     3  1207    14 kap     binary     0.567     5  0.0567
##  5     5  1974    13 kap     binary     0.567     5  0.0459
##  6     3   985    11 kap     binary     0.565     5  0.0594
##  7     4   607    10 kap     binary     0.564     5  0.0557
##  8     4   368    28 kap     binary     0.564     5  0.0455
##  9     3  1154    25 kap     binary     0.560     5  0.0468
## 10     3   579    14 kap     binary     0.559     5  0.0556</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" title="1">forest_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;roc_auc&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 8
##     mtry trees min_n .metric .estimator  mean     n std_err
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1     3   877     3 roc_auc binary     0.928     5 0.0126 
##  2     3  1714     5 roc_auc binary     0.926     5 0.0125 
##  3     4  1008     2 roc_auc binary     0.925     5 0.0135 
##  4     3   579    14 roc_auc binary     0.925     5 0.0106 
##  5     2  1965    23 roc_auc binary     0.924     5 0.0111 
##  6     5  1678     2 roc_auc binary     0.924     5 0.0133 
##  7     3   985    11 roc_auc binary     0.924     5 0.0116 
##  8     3  1207    14 roc_auc binary     0.923     5 0.0102 
##  9     4   228     2 roc_auc binary     0.923     5 0.0145 
## 10     3  1607    39 roc_auc binary     0.922     5 0.00984</code></pre>
</div>
</div>
<div id="select-best-parameters" class="section level2">
<h2><span class="header-section-number">5.10</span> Select Best Parameters</h2>
<p>Now that both models are cross validated, we can select the tuning parameters which minimized our error metric.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" title="1">params_glmnet_best &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb234-2" title="2"><span class="st">  </span>glmnet_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb234-3" title="3"><span class="st">  </span><span class="kw">select_best</span>(<span class="st">&quot;roc_auc&quot;</span>)</a>
<a class="sourceLine" id="cb234-4" title="4"></a>
<a class="sourceLine" id="cb234-5" title="5">params_glmnet_best</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    penalty mixture
##      &lt;dbl&gt;   &lt;dbl&gt;
## 1 1.71e-10  0.0903</code></pre>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" title="1">params_forest_best &lt;-</a>
<a class="sourceLine" id="cb236-2" title="2"><span class="st">  </span>forest_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb236-3" title="3"><span class="st">  </span><span class="kw">select_best</span>(<span class="st">&quot;roc_auc&quot;</span>)</a>
<a class="sourceLine" id="cb236-4" title="4"></a>
<a class="sourceLine" id="cb236-5" title="5">params_forest_best</a></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##    mtry trees min_n
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     3   877     3</code></pre>
</div>
<div id="save-best-paramenters" class="section level2">
<h2><span class="header-section-number">5.11</span> Save Best Paramenters</h2>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" title="1">glmnet_stage_<span class="dv">2</span>_model &lt;-</a>
<a class="sourceLine" id="cb238-2" title="2"><span class="st">  </span>glmnet_model <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb238-3" title="3"><span class="st">  </span><span class="kw">finalize_model</span>(<span class="dt">parameters =</span> params_glmnet_best)</a>
<a class="sourceLine" id="cb238-4" title="4"></a>
<a class="sourceLine" id="cb238-5" title="5">glmnet_stage_<span class="dv">2</span>_model</a></code></pre></div>
<pre><code>## Logistic Regression Model Specification (classification)
## 
## Main Arguments:
##   penalty = 1.71201086325859e-10
##   mixture = 0.0903275515884161
## 
## Computational engine: glmnet</code></pre>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" title="1">forest_stage_<span class="dv">2</span>_model &lt;-</a>
<a class="sourceLine" id="cb240-2" title="2"><span class="st">  </span>forest_model <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb240-3" title="3"><span class="st">  </span><span class="kw">finalize_model</span>(params_forest_best)</a>
<a class="sourceLine" id="cb240-4" title="4"></a>
<a class="sourceLine" id="cb240-5" title="5">forest_stage_<span class="dv">2</span>_model</a></code></pre></div>
<pre><code>## Random Forest Model Specification (classification)
## 
## Main Arguments:
##   mtry = 3
##   trees = 877
##   min_n = 3
## 
## Engine-Specific Arguments:
##   objective = reg:squarederror
## 
## Computational engine: randomForest</code></pre>
</div>
<div id="compare-models" class="section level2">
<h2><span class="header-section-number">5.12</span> Compare Models</h2>
<p>No, we need to compare the models to see which one performs best on our error metric.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" title="1">train_processed &lt;-</a>
<a class="sourceLine" id="cb242-2" title="2"><span class="st">  </span><span class="kw">training</span>(hof_initial_split) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-3" title="3"><span class="st">  </span><span class="kw">bake</span>(preprocessing_recipe, <span class="dt">new_data =</span> .)</a>
<a class="sourceLine" id="cb242-4" title="4"></a>
<a class="sourceLine" id="cb242-5" title="5">test_processed &lt;-</a>
<a class="sourceLine" id="cb242-6" title="6"><span class="st">  </span><span class="kw">testing</span>(hof_initial_split) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-7" title="7"><span class="st">  </span><span class="kw">bake</span>(preprocessing_recipe, <span class="dt">new_data =</span> .)</a>
<a class="sourceLine" id="cb242-8" title="8">    </a>
<a class="sourceLine" id="cb242-9" title="9">target_expr &lt;-</a>
<a class="sourceLine" id="cb242-10" title="10"><span class="st">  </span>preprocessing_recipe <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-11" title="11"><span class="st">    </span><span class="kw">pluck</span>(<span class="st">&quot;last_term_info&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-12" title="12"><span class="st">    </span><span class="kw">filter</span>(role <span class="op">==</span><span class="st"> &quot;outcome&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-13" title="13"><span class="st">    </span><span class="kw">pull</span>(variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-14" title="14"><span class="st">    </span><span class="kw">sym</span>()</a>
<a class="sourceLine" id="cb242-15" title="15"></a>
<a class="sourceLine" id="cb242-16" title="16">glmnet_stage_<span class="dv">2</span>_metrics &lt;-</a>
<a class="sourceLine" id="cb242-17" title="17"><span class="st">  </span>glmnet_stage_<span class="dv">2</span>_model <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-18" title="18"><span class="st">  </span><span class="kw">fit</span>(<span class="dt">formula =</span> inducted <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> train_processed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-19" title="19"><span class="st">  </span><span class="kw">predict</span>(<span class="dt">new_data =</span> test_processed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-20" title="20"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">testing</span>(hof_initial_split)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-21" title="21"><span class="st">  </span><span class="kw">metrics</span>(<span class="op">!!</span><span class="st"> </span>target_expr, .pred_class)</a>
<a class="sourceLine" id="cb242-22" title="22"></a>
<a class="sourceLine" id="cb242-23" title="23">forest_stage_<span class="dv">2</span>_metrics &lt;-<span class="st">   </span></a>
<a class="sourceLine" id="cb242-24" title="24"><span class="st">  </span>forest_stage_<span class="dv">2</span>_model <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-25" title="25"><span class="st">  </span><span class="kw">fit</span>(<span class="dt">formula =</span> inducted <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> train_processed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-26" title="26"><span class="st">  </span><span class="kw">predict</span>(<span class="dt">new_data =</span> test_processed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-27" title="27"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">testing</span>(hof_initial_split)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb242-28" title="28"><span class="st">  </span><span class="kw">metrics</span>(<span class="op">!!</span><span class="st"> </span>target_expr, .pred_class)</a>
<a class="sourceLine" id="cb242-29" title="29"></a>
<a class="sourceLine" id="cb242-30" title="30">glmnet_stage_<span class="dv">2</span>_metrics <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-31" title="31"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mod =</span> <span class="st">&quot;glmnet&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-32" title="32"><span class="st">  </span><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb242-33" title="33">    forest_stage_<span class="dv">2</span>_metrics <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-34" title="34"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">mod =</span> <span class="st">&quot;forest&quot;</span>)</a>
<a class="sourceLine" id="cb242-35" title="35">    ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb242-36" title="36"><span class="st">  </span><span class="kw">arrange</span>(.metric,<span class="op">-</span>.estimate)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   .metric  .estimator .estimate mod   
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; 
## 1 accuracy binary         0.932 forest
## 2 accuracy binary         0.921 glmnet
## 3 kap      binary         0.559 forest
## 4 kap      binary         0.460 glmnet</code></pre>
<p>Looks like the Random Forest is the better model.</p>
</div>
<div id="run-best-model-on-all-data" class="section level2">
<h2><span class="header-section-number">5.13</span> Run Best Model on All Data</h2>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" title="1">model_final &lt;-forest_stage_<span class="dv">2</span>_model <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb244-2" title="2"><span class="st">    </span><span class="kw">fit</span>(inducted <span class="op">~</span><span class="st"> </span>. , <span class="dt">data =</span> <span class="kw">bake</span>(preprocessing_recipe, <span class="dt">new_data =</span> hofmod))</a></code></pre></div>
</div>
<div id="run-model-on-new-data" class="section level2">
<h2><span class="header-section-number">5.14</span> Run Model on New Data</h2>
</div>
<div id="variable-importance" class="section level2">
<h2><span class="header-section-number">5.15</span> Variable Importance</h2>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb245-1" title="1"><span class="kw">vip</span>(model_final) <span class="op">+</span></a>
<a class="sourceLine" id="cb245-2" title="2"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Random Forest Model Importance - HOF Prediction&quot;</span>) </a></code></pre></div>
<p><img src="Intermediate_R_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<p><a href="https://www.r-bloggers.com/product-price-prediction-a-tidy-hyperparameter-tuning-and-cross-validation-tutorial/">Many Thanks</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="4-functional-programming.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="6-text-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
