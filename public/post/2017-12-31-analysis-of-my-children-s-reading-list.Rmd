---
title: Analysis of my Children's Reading List
author: Dusty Turner
date: '2017-12-31'
slug: analysis-of-my-children-s-reading-list
categories:
  - r
  - datascience
  - tidyverse
  - lubridate
  - children
  - books
  - tidytext
tags:
  - r
  - datascience
  - tidyverse
  - lubridate
  - children
  - books
  - tidytext
output: 
  blogdown::html_page:
    toc: TRUE
    toc_depth: 2
    # dev: "svg"
    # theme: lumen
    highlight: tango
    # code_folding: show  #doesn't work yet with html_page
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 150)
options(stringsAsFactors = FALSE)
```

## Introduction

Over this Christmas break, my wife was inpired to keep track of the books we read to our kids.  Her goal is to amass 1000 books in 2018.  She downloaded 'Bookbuddy' on her Iphone and can scan the barcodes with the camera.  Doing this, saves a lot of data about the books.  After a quick export, we have a nice csv.  

Ever on the lookout for cool data science projects, this peaked my interest.  

What follows below is a growing look to provide insight to what we read our kids.  

Lets start with some...

## Exploratory Data Analysis

### Libraries

The libraries I will use for this analysis are the following:

```{r echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}
library(tidyverse)
library(lubridate)
library(janitor)
library(tidytext)
```

Lets read in the data and get a feel for what information we have available.  Since my wife, our babysitter, and I have scanned the books in bookbuddy, I need to upload all the data and join it together.  Many of the column names have spaces which does not support data munging.  I'll use the `clean_names` command from the `janitor` package to clean this up.  Lastly, you'll not I used the `distinct` call because some of us scanned the same books. We do not want to account for them twice.  

```{r echo=TRUE, message=FALSE, warning=FALSE, paged.print=FALSE}
book1 = read_csv("books.csv") 
book2 = read_csv("BookBuddy.csv")
book3 = read_csv("BookBuddy2.csv")
book4 = read_csv("BookBuddy3.csv")
booksread =
  book1 %>% bind_rows(book2) %>% bind_rows(book3) %>% bind_rows(book4)  %>%
  clean_names(case = "upper_camel") %>%
    distinct()

head(booksread)
```



There are 'ton' of colums, many of them are nothing but `nas`, so I'll eliminate those immediatly.  

```{r, echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}
booksread = booksread %>% 
  select_if(function(x) any(!is.na(x)))
summary(booksread)
```

Some of the features are redundant, some are full of `0`s, and some are otherwise uninteresting, so I'll select what is of value:

```{r, echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}
books = booksread %>%
  select(Title, Author, Publisher, DatePublished, YearPublished,
         Genre, Summary, NumberOfPages, DateAdded) 

head(books)
```

Lets take a look at what Authors we typically select for our kids.


```{r, echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}
ggplot(data = books, aes(Author)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Oh man, that's indecipherable.  Lets only select the Authors where we've read at least 3 of their books.

```{r, echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}
books %>%
  group_by(Author) %>%
  add_tally() %>%
  filter(n>3) %>%
  ungroup() %>%
  ggplot(aes(fct_reorder(Author,-n))) +
  geom_bar(aes(fill = log(n))) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(legend.position = "none") +
  xlab("Author")
```

Clearly, we read a lot of Berenstain Bear books - but notice how Bookbuddy saves the Berenstain Author.  Lets collapse them all into one Author

```{r, echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}
books = books %>%
  mutate(Author = ifelse(grepl("Bere", Author)==TRUE, "Berenstein", Author))

books %>%
  group_by(Author) %>%
  add_tally() %>%
  filter(n>3) %>%
  ungroup() %>%
  ggplot(aes(fct_reorder(Author,-n))) +
  geom_bar(aes(fill = log(n))) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(legend.position = "none")
```

Nice!! - But wow, we read a lot of books about the Berenstien Bears.  Lets take a look at the type of material that we are putting in our kids head.  

But first, we read a book written by 'God'?  Lets investigate.

```{r, echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}
books %>%
  filter(Author=="God")
```

Okay then.

The next few charts depict the year the books were first published, the number of pages, the Genre of the books.

```{r, echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}
ggplot(data = books, aes(YearPublished)) +
  geom_bar() +
  ggtitle("Books By Year") + ylab("Total Books")

ggplot(data = books, aes(NumberOfPages)) +
  geom_histogram() +
  ggtitle("Books By Number of Pages") + ylab("Total Books")
```


There are a ton of odd Genre's and I've eliminated several.  Lets take a look at that:

```{r, echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}
books = books %>%
  mutate(Genre = ifelse(Genre=="Otters"|Genre=="Beavers"|Genre=="Cows"|Genre=="Rabbits"|Genre=="Animal tracks"|Genre=="Horses"|Genre=="Deer","Animals",Genre)) %>%
  mutate(Genre = ifelse(Genre=="Hair in Fiction", "Juvenile Fiction", Genre))

books %>%
  group_by(Genre) %>%
  add_tally() %>%
  filter(n>2, !is.na(Genre)) %>%
ggplot(aes(Genre, fill = Genre)) +
  geom_bar() +
  ggtitle("Books By Genre") + ylab("Total Books")  +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme(legend.position = "none")
```

Notice, I filtered out some `NAs`.  Lets take a look at what what are these `NA`s are?

```{r, echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}
books %>%
  filter(is.na(Genre))
```

## Text Analysis

Now that we've explored the dataset, lets see what information we can glean.  

I'd really like to know what type of words / sentiment we are reading our children -- but until I can figure out a way to get the words from all the books, I'll have to use the `Summary` provided by BookBuddy.  
Here's an example:

```{r, echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}
books %>%
  filter(Title=="Mama Cat Has Three Kittens") %>%
  select(Summary)
```

So, lets prepare the data.  I'd like to bring along some information while I tokenize the summaries (Titles, Authors, and Genres).  We'd also like to translate NRCs emotions into `Positive`, `Negative`, and `Neutral` classifications.  

```{r, echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}
text_df = data_frame(line = 1:length(books$Summary), text = as.character(books$Summary), book = books$Title, Genre = books$Genre, Author = books$Author)

textcleaned = text_df %>%
  unnest_tokens(word, text)

cleanedarticle = anti_join(textcleaned,stop_words, by = "word")

nrc = get_sentiments("nrc")

booksentimentnrc = cleanedarticle %>%
  inner_join(nrc, by = "word")

booksentimentnrc = booksentimentnrc %>%
  mutate(sent = ifelse(sentiment=="joy"|sentiment=="positive"|sentiment=="suprise"|sentiment=="trust","Positive Words",
                       ifelse(sentiment=="disgust"|sentiment=="fear"|sentiment=="negative"|sentiment=="sadness","Negative Words","Neutral Words"))) %>%
  mutate(sent = as.factor(sent))

booksentimentnrc
```

Lets look at the sentiment my children are receiving in their books (as told by the summaries)

```{r, echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}
ggplot(data = booksentimentnrc, aes(sent, color = sentiment, fill = sentiment)) +
  geom_bar() +
  ggtitle("Type of Words my Children Listen in Books") + xlab("Sentiment") + ylab("Total Count")
```

Maybe it would be more interesting to see which Authrors are providing which sentiments.


```{r, echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}

booksentimentnrc %>%
  group_by(Author) %>%
  add_tally() %>%
  filter(n>100) %>%

ggplot(aes(sent, color = sentiment, fill = sentiment)) +
  geom_bar() +
  facet_wrap("Author", scales = "free_y") +
  ggtitle("Type of Words my Children Listen in Books") + xlab("Sentiment") + ylab("Total Count")  +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


Lastly, lets see if there's a genre that has any sentiment sway.  Of note, I find it funny that there is a 'Bears' genre.  

```{r, echo=TRUE, message=FALSE, warning=FALSE, show = FALSE}

booksentimentnrc %>%
  group_by(Genre) %>%
  add_tally() %>%
  filter(!is.na(Genre)) %>%
  filter(n>15) %>%
ggplot(aes(sent, fill = sent)) +
  geom_bar() +
  facet_wrap("Genre", scales = "free_y") +
  ggtitle("Sentiment by Genre") + xlab("Sentiment")
```

## Further analysis to follow as we read books throughout the year.  
